{"version":3,"sources":["components/CallAvatar/index.js"],"names":["REGEXP_BLOB_URL","REGEXP_BASE64_URL","isBlobURL","value","test","isBase64","CallAvatar","props","state","avatarUrl","_mounted","setState","$img","document","createElement","src","onload","onerror","loadImg","nextProps","extraNum","isOnConferenceCall","spinnerMode","shouldBubbleClick","initialSize","margin","avatarCircleRadius","extraNumCircleRadius","extraNumCircleBorder","circleBorder","$snow","$blueLight","$blue","$dark","$transparency","defaultAvatarStyle","opacity","hash","uuid","v4","textId","clipId","avatarStyle","stroke","strokeWidth","showingSpinner","spinnerId","spinnerScaleSize","spinnerSize","spinnerTranslateTo","isOnConferenceCallWithExtraNum","spinnerTransform","res","styles","callAvatar","bubbleSvg","fontSize","fill","portrait","fontWeight","Component","propTypes","PropTypes","bool","string","number","defaultProps"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport uuid from 'uuid';\nimport classnames from 'classnames';\nimport styles from './styles.scss';\nimport SpinnerIcon from '../../assets/images/Spinner.svg';\n\nconst REGEXP_BLOB_URL = /^blob:.+\\/[\\w-]{36,}(?:#.+)?$/;\nconst REGEXP_BASE64_URL = /^(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)?(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+\\/]{3}=)?$/gi;\n\nfunction isBlobURL(value) {\n  return REGEXP_BLOB_URL.test(value);\n}\n\nfunction isBase64(value) {\n  return REGEXP_BASE64_URL.test(value);\n}\n\nclass CallAvatar extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      avatarUrl: null\n    };\n    this._mounted = false;\n  }\n\n  loadImg(props = this.props) {\n    const { avatarUrl } = props;\n\n    if (isBlobURL(avatarUrl) || isBase64(avatarUrl)) {\n      this.setState({\n        avatarUrl\n      });\n      return;\n    }\n\n    // means we have to load it\n    if (!this._mounted) {\n      return;\n    }\n    if (avatarUrl) {\n      const $img = document.createElement('img');\n      $img.src = avatarUrl;\n      $img.onload = () => {\n        if (!this._mounted) {\n          return;\n        }\n        this.setState({\n          avatarUrl\n        });\n      };\n      $img.onerror = () => {\n        if (!this._mounted) {\n          return;\n        }\n        this.setState({\n          avatarUrl: null\n        });\n      };\n    }\n  }\n\n  componentWillMount() {\n    this.loadImg();\n  }\n\n  componentDidMount() {\n    this._mounted = true;\n    if (!this.state.avatarUrl) {\n      this.loadImg();\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.avatarUrl !== this.props.avatarUrl) {\n      this.loadImg(nextProps);\n    }\n  }\n\n  componentWillUnmount() {\n    this._mounted = false;\n  }\n\n  render() {\n    const {\n      extraNum, isOnConferenceCall, spinnerMode, shouldBubbleClick\n    } = this.props;\n    const { avatarUrl } = this.state;\n    const initialSize = 38;\n    const margin = 4;\n    const avatarCircleRadius = 15;\n    const extraNumCircleRadius = 8.5;\n    const extraNumCircleBorder = 1;\n    const circleBorder = 1;\n    const $snow = '#fff';\n    const $blueLight = '#cee7f2';\n    const $blue = '#0684bd';\n    const $dark = '#e2e2e2';\n    const $transparency = '0.8';\n    const defaultAvatarStyle = { opacity: +$transparency };\n    const hash = uuid.v4();\n    const textId = `text-${hash}`;\n    const clipId = `circleClip-${hash}`;\n    const avatarStyle = { stroke: $dark, strokeWidth: `${circleBorder}px` };\n    const showingSpinner = spinnerMode;\n\n    // spinner sizing\n    const spinnerId = `spinner-${hash}`;\n    const spinnerScaleSize = 1.5;\n    const spinnerSize = 12;\n    const spinnerTranslateTo = (initialSize - (spinnerSize * spinnerScaleSize)) / 2;\n    const isOnConferenceCallWithExtraNum = isOnConferenceCall && extraNum > 0;\n    const spinnerTransform = `translate(${spinnerTranslateTo\n      - (isOnConferenceCallWithExtraNum ? margin : 0)},${spinnerTranslateTo}) scale(${\n      spinnerScaleSize\n    }, ${spinnerScaleSize})`;\n\n    let res;\n\n    if (isOnConferenceCallWithExtraNum) {\n      res = (\n        <svg\n          className={shouldBubbleClick ?\n            classnames(styles.callAvatar, styles.bubbleSvg) :\n            styles.callAvatar}\n          style={avatarUrl ? avatarStyle : null}\n          viewBox={`0 0 ${initialSize} ${initialSize}`}\n          preserveAspectRatio=\"xMidYMid meet\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <defs>\n            <g id={textId}>\n              <text\n                x=\"0\"\n                y=\"0\"\n                dy={`${initialSize - 10}px`}\n                style={{\n                      fontSize: `${avatarCircleRadius * 2}px`,\n                      fill: $blue,\n                      opacity: '.5'\n                    }}\n                className={styles.portrait}\n                // HACK: &#xe904; is the font code for the portrait icon\n                >\n                {'\\ue904'}\n              </text>\n            </g>\n            <SpinnerIcon id={spinnerId} />\n          </defs>\n          <circle\n            cx={avatarCircleRadius}\n            cy={margin + avatarCircleRadius}\n            r={avatarCircleRadius}\n            fill={$snow}\n            stroke={showingSpinner ? $dark : 'inherit'}\n            strokeOpacity={showingSpinner ? $transparency : '1'}\n          />\n          <g>\n            <clipPath id={clipId}>\n              <circle\n                cx={avatarCircleRadius}\n                cy={margin + avatarCircleRadius}\n                r={avatarCircleRadius}\n                fill={$snow} />\n            </clipPath>\n          </g>\n          {\n            showingSpinner && (\n              <g transform={spinnerTransform}>\n                <use xlinkHref={`#${spinnerId}`} />\n              </g>\n            )\n          }\n          {\n            avatarUrl && (\n              <image clipPath={`url(#${clipId})`} height=\"100%\" width=\"100%\" xlinkHref={avatarUrl} />\n            )\n          }\n          {\n            (!avatarUrl && !showingSpinner) &&\n            <use\n              xlinkHref={`#${textId}`}\n              clipPath={`url(#${clipId})`}\n              style={defaultAvatarStyle}\n            />\n          }\n          <circle\n            cx={initialSize - extraNumCircleRadius}\n            cy={extraNumCircleRadius}\n            r={extraNumCircleRadius}\n            fill={$snow} />\n          <circle\n            cx={initialSize - extraNumCircleRadius}\n            cy={extraNumCircleRadius}\n            r={extraNumCircleRadius - extraNumCircleBorder}\n            fill={$blueLight} />\n\n          <text\n            x={initialSize - extraNumCircleRadius}\n            y={extraNumCircleRadius}\n            dy=\"3px\"\n            textAnchor=\"middle\"\n            style={{\n              fontSize: '9px',\n              stroke: 'none',\n              fill: $blue,\n              fontWeight: 'bolder',\n              opacity: '.5'\n            }}>\n            {`+${extraNum}`}\n          </text>\n        </svg>\n      );\n    } else {\n      res = (\n        <svg\n          className={styles.callAvatar}\n          style={avatarUrl ? avatarStyle : null}\n          viewBox={`0 0 ${initialSize} ${initialSize}`}\n          xmlns=\"http://www.w3.org/2000/svg\">\n          <defs>\n            <g id={textId}>\n              <text\n                x=\"0\"\n                y=\"0\"\n                dy={`${initialSize - 10}px`}\n                dx=\"2\"\n                style={{\n                      fontSize: `${(initialSize / 2 - 2) * 2}px`,\n                      fill: $blue,\n                      opacity: '.5'\n                    }}\n                className={styles.portrait}>\n                {'\\ue904'}\n              </text>\n            </g>\n            <SpinnerIcon id={spinnerId} />\n          </defs>\n          <circle\n            cx={initialSize / 2}\n            cy={initialSize / 2}\n            r={initialSize / 2 - circleBorder}\n            fill={$snow}\n            stroke={showingSpinner ? $dark : 'inherit'}\n            strokeOpacity={showingSpinner ? $transparency : '1'}\n          />\n          <g>\n            <clipPath id={clipId}>\n              <circle\n                cx={initialSize / 2}\n                cy={initialSize / 2}\n                r={initialSize / 2 - 1}\n              />\n            </clipPath>\n          </g>\n          {\n            showingSpinner && (\n              <g transform={spinnerTransform} >\n                <use xlinkHref={`#${spinnerId}`} />\n              </g>\n            )\n          }\n          {\n            showingSpinner && (\n              <g transform={spinnerTransform} >\n                <use xlinkHref={`#${spinnerId}`} />\n              </g>\n            )\n          }\n          {\n            avatarUrl && (<image\n              clipPath={`url(#${clipId})`}\n              height=\"100%\"\n              width=\"100%\"\n              xlinkHref={avatarUrl}\n              preserveAspectRatio=\"xMinYMin slice\" />\n            )\n          }\n          {\n            (!avatarUrl && !showingSpinner) &&\n            <use\n              xlinkHref={`#${textId}`}\n              clipPath={`url(#${clipId})`}\n              style={defaultAvatarStyle}\n            />\n          }\n        </svg>\n      );\n    }\n    return res;\n  }\n}\n\n\nCallAvatar.propTypes = {\n  isOnConferenceCall: PropTypes.bool,\n  avatarUrl: PropTypes.string,\n  extraNum: PropTypes.number,\n  /**\n   * Set to true to make it always show the loading spinner.\n   */\n  spinnerMode: PropTypes.bool,\n  shouldBubbleClick: PropTypes.bool\n};\n\nCallAvatar.defaultProps = {\n  isOnConferenceCall: false,\n  avatarUrl: null,\n  extraNum: 0,\n  spinnerMode: false,\n  shouldBubbleClick: false,\n};\n\n\nexport default CallAvatar;\n"]}