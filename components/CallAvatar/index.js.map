{"version":3,"sources":["components/CallAvatar/index.js"],"names":["REGEXP_BLOB_URL","REGEXP_BASE64_URL","isBlobURL","value","test","isBase64","CallAvatar","props","state","avatarUrl","avatarUrlLoadFailed","_mounted","setState","$img","document","createElement","src","onload","onerror","loadImg","nextProps","extraNum","isOnConferenceCall","spinnerMode","avatarUrlSource","initialSize","margin","avatarCircleRadius","extraNumCircleRadius","extraNumCircleBorder","circleBorder","$snow","$blueLight","$blue","$dark","$transparency","res","hash","uuid","v4","textId","clipId","avatarStyle","stroke","strokeWidth","showSpinner","spinnerId","spinnerScaleSize","spinnerSize","spinnerTranslateTo","isOnConferenceCallWithExtraNum","spinnerTransform","styles","callAvatar","fontSize","fill","opacity","portrait","fontWeight","Component","propTypes","PropTypes","bool","string","number","defaultProps"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport uuid from 'uuid';\nimport styles from './styles.scss';\nimport SpinnerIcon from '../../assets/images/Spinner.svg';\n\nconst REGEXP_BLOB_URL = /^blob:.+\\/[\\w-]{36,}(?:#.+)?$/;\nconst REGEXP_BASE64_URL = /^(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)?(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+\\/]{3}=)?$/gi;\n\nfunction isBlobURL(value) {\n  return REGEXP_BLOB_URL.test(value);\n}\n\nfunction isBase64(value) {\n  return REGEXP_BASE64_URL.test(value);\n}\n\nclass CallAvatar extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      avatarUrl: null,\n      avatarUrlLoadFailed: false\n    };\n    this._mounted = false;\n  }\n\n  loadImg(props = this.props) {\n    const { avatarUrl } = props;\n\n    if (isBlobURL(avatarUrl) || isBase64(avatarUrl)) {\n      this.setState({\n        avatarUrl\n      });\n      return;\n    }\n\n    // means we have to load it\n    if (!this._mounted) {\n      return;\n    }\n    if (avatarUrl) {\n      const $img = document.createElement('img');\n      $img.src = avatarUrl;\n      $img.onload = () => {\n        if (!this._mounted) {\n          return;\n        }\n        this.setState({\n          avatarUrl\n        });\n      };\n      $img.onerror = () => {\n        if (!this._mounted) {\n          return;\n        }\n        this.setState({\n          avatarUrl: null,\n          avatarUrlLoadFailed: true\n        });\n      };\n    }\n  }\n\n  componentWillMount() {\n    this.loadImg();\n  }\n\n  componentDidMount() {\n    this._mounted = true;\n    if (!this.state.avatarUrl) {\n      this.loadImg();\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.avatarUrl !== this.props.avatarUrl) {\n      this.loadImg(nextProps);\n    }\n  }\n\n  componentWillUnmount() {\n    this._mounted = false;\n  }\n\n  render() {\n    const { extraNum, isOnConferenceCall, spinnerMode } = this.props;\n    const avatarUrlSource = this.props.avatarUrl;\n    const { avatarUrl } = this.state;\n    const initialSize = 38;\n    const margin = 4;\n    const avatarCircleRadius = 15;\n    const extraNumCircleRadius = 8.5;\n    const extraNumCircleBorder = 1;\n    const circleBorder = 1;\n    const $snow = '#fff';\n    const $blueLight = '#cee7f2';\n    const $blue = '#0684bd';\n    const $dark = '#e2e2e2';\n    const $transparency = '0.8';\n    let res;\n    const hash = uuid.v4();\n    const textId = `text-${hash}`;\n    const clipId = `circleClip-${hash}`;\n    const avatarStyle = { stroke: $dark, strokeWidth: `${circleBorder}px` };\n    const avatarUrlLoadFailed = this.state.avatarUrlLoadFailed;\n    const showSpinner = spinnerMode;\n\n    // spinner sizing\n    const spinnerId = `spinner-${hash}`;\n    const spinnerScaleSize = 1.5;\n    const spinnerSize = 12;\n    const spinnerTranslateTo = (initialSize - (spinnerSize * spinnerScaleSize)) / 2;\n    const isOnConferenceCallWithExtraNum = isOnConferenceCall && extraNum > 0;\n    const spinnerTransform = `translate(${spinnerTranslateTo - (isOnConferenceCallWithExtraNum ? margin : 0)},${spinnerTranslateTo}) scale(${spinnerScaleSize}, ${spinnerScaleSize})`;\n    if (isOnConferenceCallWithExtraNum) {\n      res = (\n        <svg\n          className={styles.callAvatar}\n          style={avatarUrl ? avatarStyle : null}\n          viewBox={`0 0 ${initialSize} ${initialSize}`}\n          preserveAspectRatio=\"xMidYMid meet\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <defs>\n            <g id={textId}>\n              <text\n                x=\"0\"\n                y=\"0\"\n                dy={`${initialSize - 10}px`}\n                style={{\n                      fontSize: `${avatarCircleRadius * 2}px`,\n                      fill: $blue,\n                      opacity: '.5'\n                    }}\n                className={styles.portrait}\n                // HACK: &#xe904; is the font code for the portrait icon\n                >\n                {'\\ue904'}\n              </text>\n            </g>\n            <SpinnerIcon id={spinnerId} />\n          </defs>\n          <circle\n            cx={avatarCircleRadius}\n            cy={margin + avatarCircleRadius}\n            r={avatarCircleRadius}\n            fill={$snow}\n            stroke={showSpinner ? $dark : 'inherit'}\n            strokeOpacity={showSpinner ? $transparency : '1'}\n          />\n          <g>\n            <clipPath id={clipId}>\n              <circle\n                cx={avatarCircleRadius}\n                cy={margin + avatarCircleRadius}\n                r={avatarCircleRadius}\n                fill={$snow} />\n            </clipPath>\n          </g>\n          {\n            showSpinner && (\n              <g transform={spinnerTransform}>\n                <use xlinkHref={`#${spinnerId}`} />\n              </g>\n            )\n          }\n          {\n            avatarUrl && (\n              <image clipPath={`url(#${clipId})`} height=\"100%\" width=\"100%\" xlinkHref={avatarUrl} />\n            )\n          }\n          {\n            (!showSpinner && (!avatarUrlSource || !avatarUrl || avatarUrlLoadFailed)) && <use xlinkHref={`#${textId}`} clipPath={`url(#${clipId})`} />\n          }\n          <circle\n            cx={initialSize - extraNumCircleRadius}\n            cy={extraNumCircleRadius}\n            r={extraNumCircleRadius}\n            fill={$snow} />\n          <circle\n            cx={initialSize - extraNumCircleRadius}\n            cy={extraNumCircleRadius}\n            r={extraNumCircleRadius - extraNumCircleBorder}\n            fill={$blueLight} />\n\n          <text\n            x={initialSize - extraNumCircleRadius}\n            y={extraNumCircleRadius}\n            dy=\"3px\"\n            textAnchor=\"middle\"\n            style={{\n              fontSize: '9px',\n              stroke: 'none',\n              fill: $blue,\n              fontWeight: 'bolder',\n              opacity: '.5'\n            }}>\n            {`+${extraNum}`}\n          </text>\n        </svg>\n      );\n    } else {\n      res = (\n        <svg\n          className={styles.callAvatar}\n          style={avatarUrl ? avatarStyle : null}\n          viewBox={`0 0 ${initialSize} ${initialSize}`}\n          xmlns=\"http://www.w3.org/2000/svg\">\n          <defs>\n            <g id={textId}>\n              <text\n                x=\"0\"\n                y=\"0\"\n                dy={`${initialSize - 10}px`}\n                dx=\"2\"\n                style={{\n                      fontSize: `${(initialSize / 2 - 2) * 2}px`,\n                      fill: $blue,\n                      opacity: '.5'\n                    }}\n                className={styles.portrait}>\n                {'\\ue904'}\n              </text>\n            </g>\n            <SpinnerIcon id={spinnerId} />\n          </defs>\n          <circle\n            cx={initialSize / 2}\n            cy={initialSize / 2}\n            r={initialSize / 2 - circleBorder}\n            fill={$snow}\n            stroke={showSpinner ? $dark : 'inherit'}\n            strokeOpacity={showSpinner ? $transparency : '1'}\n          />\n          <g>\n            <clipPath id={clipId}>\n              <circle\n                cx={initialSize / 2}\n                cy={initialSize / 2}\n                r={initialSize / 2 - 1}\n              />\n            </clipPath>\n          </g>\n          {\n            showSpinner && (\n              <g transform={spinnerTransform} >\n                <use xlinkHref={`#${spinnerId}`} />\n              </g>\n            )\n          }\n          {\n            showSpinner && (\n              <g transform={spinnerTransform} >\n                <use xlinkHref={`#${spinnerId}`} />\n              </g>\n            )\n          }\n          {\n            avatarUrl && (<image\n              clipPath={`url(#${clipId})`}\n              height=\"100%\"\n              width=\"100%\"\n              xlinkHref={avatarUrl}\n              preserveAspectRatio=\"xMinYMin slice\" />\n            )\n          }\n          {\n            (!showSpinner && (!avatarUrlSource || !avatarUrl || avatarUrlLoadFailed)) && <use xlinkHref={`#${textId}`} clipPath={`url(#${clipId})`} />\n          }\n        </svg>\n      );\n    }\n    return res;\n  }\n}\n\n\nCallAvatar.propTypes = {\n  isOnConferenceCall: PropTypes.bool,\n  avatarUrl: PropTypes.string,\n  extraNum: PropTypes.number,\n  /**\n   * Set to true to make it always show the loading spinner.\n   */\n  spinnerMode: PropTypes.bool,\n};\n\nCallAvatar.defaultProps = {\n  isOnConferenceCall: false,\n  avatarUrl: null,\n  extraNum: 0,\n  spinnerMode: false,\n};\n\n\nexport default CallAvatar;\n"]}