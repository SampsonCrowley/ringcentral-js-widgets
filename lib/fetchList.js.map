{"version":3,"sources":["lib/fetchList.js"],"names":["parallelFetch","fn","perPage","params","page","data","list","records","slice","paging","totalPages","promises","i","push","Promise","all","output","item","reduce","serialFetch","fetchedPages","fetchList","parallel"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;SACeA,a;;;;;;;0BAAf,iBAA6BC,EAA7B,EAAiCC,OAAjC,EAA0CC,MAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACqBF,EAAE,mBAChBE,MADgB;AAEnBD,cAAAA,OAAO,EAAPA,OAFmB;AAGnBE,cAAAA,IAAI,EAAE;AAHa,eADvB;;AAAA;AACQC,YAAAA,IADR;AAMQC,YAAAA,IANR,GAMeD,IAAI,CAACE,OAAL,CAAaC,KAAb,EANf;;AAAA,kBAOMH,IAAI,CAACI,MAAL,CAAYC,UAAZ,GAAyB,CAP/B;AAAA;AAAA;AAAA;;AAQUC,YAAAA,QARV,GAQqB,EARrB;;AASI,iBAASC,CAAT,GAAaP,IAAI,CAACI,MAAL,CAAYC,UAAzB,EAAqCE,CAAC,GAAG,CAAzC,EAA4CA,CAAC,IAAI,CAAjD,EAAoD;AAClDD,cAAAA,QAAQ,CAACE,IAAT,CAAcZ,EAAE,mBACXE,MADW;AAEdD,gBAAAA,OAAO,EAAPA,OAFc;AAGdE,gBAAAA,IAAI,EAAEQ;AAHQ,iBAAhB;AAKD;;AAfL;AAAA,mBAgBWE,OAAO,CAACC,GAAR,CAAYJ,QAAZ,CAhBX;;AAAA;AAAA,0BAgByC,UAACK,MAAD,EAASC,IAAT,EAAkB;AACrDD,cAAAA,MAAM,CAACH,IAAP,OAAAG,MAAM,qBAASC,IAAI,CAACV,OAAd,EAAN;AACA,qBAAOS,MAAP;AACD,aAnBL;;AAAA,0BAmBOV,IAnBP;;AAAA,0BAgBkCY,MAhBlC;;AAAA;AAAA,6CAqBSZ,IArBT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAwBea,W;;;;;;;0BAAf,kBAA2BlB,EAA3B,EAA+BC,OAA/B,EAAwCC,MAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AACMiB,YAAAA,YADN,GACqB,CADrB;AAEMV,YAAAA,UAFN,GAEmB,CAFnB;AAGQJ,YAAAA,IAHR,GAGe,EAHf;;AAAA;AAAA,kBAKSc,YAAY,GAAGV,UALxB;AAAA;AAAA;AAAA;;AAMIU,YAAAA,YAAY,IAAI,CAAhB;AANJ;AAAA,mBAOuBnB,EAAE,mBAChBE,MADgB;AAEnBD,cAAAA,OAAO,EAAPA,OAFmB;AAGnBE,cAAAA,IAAI,EAAEgB;AAHa,eAPzB;;AAAA;AAOUf,YAAAA,IAPV;;AAYI;AACAK,YAAAA,UAAU,GAAGL,IAAI,CAACI,MAAL,CAAYC,UAAzB;AACAJ,YAAAA,IAAI,CAACO,IAAL,OAAAP,IAAI,qBAASD,IAAI,CAACE,OAAd,EAAJ;AAdJ;AAAA;;AAAA;AAAA,8CAgBSD,IAhBT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAmB8Be,S;;;;;;;0BAAf,kBAAyBpB,EAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,8EAIX,EAJW;AAAA,gCACbC,OADa,EACbA,OADa,6BACH,KADG,sCAEboB,QAFa,EAEbA,QAFa,8BAEF,IAFE,kBAGVnB,MAHU;AAAA,8CAKNmB,QAAQ,GACbtB,aAAa,CAACC,EAAD,EAAKC,OAAL,EAAcC,MAAd,CADA,GAEbgB,WAAW,CAAClB,EAAD,EAAKC,OAAL,EAAcC,MAAd,CAPA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["\nasync function parallelFetch(fn, perPage, params) {\n  const data = await fn({\n    ...params,\n    perPage,\n    page: 1,\n  });\n  const list = data.records.slice();\n  if (data.paging.totalPages > 1) {\n    const promises = [];\n    for (let i = data.paging.totalPages; i > 1; i -= 1) {\n      promises.push(fn({\n        ...params,\n        perPage,\n        page: i,\n      }));\n    }\n    (await Promise.all(promises)).reduce((output, item) => {\n      output.push(...item.records);\n      return output;\n    }, list);\n  }\n  return list;\n}\n\nasync function serialFetch(fn, perPage, params) {\n  let fetchedPages = 0;\n  let totalPages = 1;\n  const list = [];\n\n  while (fetchedPages < totalPages) {\n    fetchedPages += 1;\n    const data = await fn({\n      ...params,\n      perPage,\n      page: fetchedPages,\n    });\n    /* eslint { \"prefer-destructuring\": 0 } */\n    totalPages = data.paging.totalPages;\n    list.push(...data.records);\n  }\n  return list;\n}\n\nexport default async function fetchList(fn, {\n  perPage = 'MAX',\n  parallel = true,\n  ...params\n} = {}) {\n  return parallel ?\n    parallelFetch(fn, perPage, params) :\n    serialFetch(fn, perPage, params);\n}\n"],"file":"fetchList.js"}