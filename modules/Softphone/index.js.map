{"version":3,"sources":["modules/Softphone/index.js"],"names":["Softphone","deps","dep","optional","brand","extensionMode","callHandler","contactMatcher","options","actionTypes","_brand","_extensionMode","_callHandler","_contactMatcher","_reducer","phoneNumber","store","dispatch","type","startToConnect","cmd","encodeURIComponent","uri","protocol","command","window","open","navigator","msLaunchUri","ActiveXObject","frame","document","createElement","style","display","body","appendChild","contentWindow","location","href","removeChild","forceMatchNumber","connectComplete","id","moduleStatuses","ready","state","connectingPhoneNumber","softphoneStatus","RcModule","proxify"],"mappings":"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","sourcesContent":["import sleep from '../../lib/sleep';\nimport { Module } from '../../lib/di';\nimport RcModule from '../../lib/RcModule';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport actionTypes from './actionTypes';\nimport getSoftphoneReducer from './getSoftphoneReducer';\nimport proxify from '../../lib/proxy/proxify';\n\n/**\n * @class\n * @description Softphone module to call softphone\n */\n@Module({\n  deps: [\n    'Brand',\n    { dep: 'ContactMatcher', optional: true },\n    { dep: 'SoftphoneOptions', optional: true },\n  ]\n})\nexport default class Softphone extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Brnad} params.brand - brand module instance\n   * @param {Bool} params.extensionMode - default false\n   * @param {Function} param.callHandler - custom call handler, optional\n   * @param {MontactMatcher} param.contactMatcher - contactMatcher module instance, optional\n   */\n  constructor({\n    brand,\n    extensionMode = false,\n    callHandler,\n    contactMatcher,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._brand = brand;\n    this._extensionMode = extensionMode;\n    this._callHandler = callHandler;\n    this._contactMatcher = contactMatcher;\n    this._reducer = getSoftphoneReducer(this.actionTypes);\n  }\n\n  _onStateChange() {\n    /* do nothing */\n  }\n\n  get protocol() {\n    switch (this._brand.id) {\n      case '3420': // ATT\n        return 'attvr20';\n      case '7710': // BT\n        return 'rcbtmobile';\n      case '7310': // TELUS\n        return 'rctelus';\n      default:\n        return 'rcmobile';\n    }\n  }\n\n  @proxify\n  async makeCall(phoneNumber) {\n    this.store.dispatch({\n      type: this.actionTypes.startToConnect,\n      phoneNumber,\n    });\n\n    const cmd = `call?number=${encodeURIComponent(phoneNumber)}`;\n    const uri = `${this.protocol}://${cmd}`;\n\n    if (this._callHandler) {\n      this._callHandler({\n        protocol: this.protocol,\n        command: cmd,\n        phoneNumber,\n      });\n    } else if (this._extensionMode) {\n      // TODO use window.open in extension background, this method will crash chrome when\n      // executed in background page.\n      window.open(uri);\n    } else if (window.navigator.msLaunchUri) {\n      // to support ie to start the service\n      window.navigator.msLaunchUri(uri);\n    } else if (window.ActiveXObject || 'ActiveXObject' in window) {\n      // to support ie on Windows < 8\n      window.open(uri);\n    } else {\n      const frame = document.createElement('iframe');\n      frame.style.display = 'none';\n\n      document.body.appendChild(frame);\n      await sleep(100);\n      frame.contentWindow.location.href = uri;\n      await sleep(300);\n      document.body.removeChild(frame);\n    }\n\n    if (this._contactMatcher) {\n      await this._contactMatcher.forceMatchNumber({\n        phoneNumber,\n      });\n    }\n\n    this.store.dispatch({\n      type: this.actionTypes.connectComplete,\n    });\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get status() {\n    return moduleStatuses.ready;\n  }\n\n  get connectingPhoneNumber() {\n    return this.state.connectingPhoneNumber;\n  }\n\n  get softphoneStatus() {\n    return this.state.softphoneStatus;\n  }\n}\n"],"file":"index.js"}