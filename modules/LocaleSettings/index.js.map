{"version":3,"sources":["modules/LocaleSettings/index.js"],"names":["LocaleSettings","name","deps","dep","optional","globalStorage","locale","supportedLocales","DEFAULT_LOCALE","options","_globalStorage","ensureExist","_locale","_supportedLocales","_storageKey","registerReducer","key","reducer","actionTypes","pending","ready","store","dispatch","type","init","savedLocale","saveLocale","currentLocale","setLocale","initSuccess","Enum","Object","keys","moduleActionTypes","status","state","getItem","RcModule","selector","s","slice","sort","proxify"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAgBqBA,c;AAdrB;;AAEA;;;;OAIC,gBAAO;AACNC,EAAAA,IAAI,EAAE,gBADA;AAENC,EAAAA,IAAI,EAAE,CACJ,eADI,EAEJ,QAFI,EAGJ;AAAEC,IAAAA,GAAG,EAAE,uBAAP;AAAgCC,IAAAA,QAAQ,EAAE;AAA1C,GAHI;AAFA,CAAP,C;;;;;AASC;;;;;AAKA,4BAKQ;AAAA;;AAAA;;AAAA,mFAAJ,EAAI;;AAAA,QAJNC,aAIM,QAJNA,aAIM;AAAA,QAHNC,MAGM,QAHNA,MAGM;AAAA,qCAFNC,gBAEM;AAAA,QAFNA,gBAEM,sCAFa,CAACC,oBAAD,CAEb;AAAA,QADHC,OACG;;AAAA;;AACN,0GACKA,OADL;;AADM;;AAIN,UAAKC,cAAL,GAAsB,mEAAMC,oBAAN,iBAAkBN,aAAlB,EAAiC,eAAjC,CAAtB;AACA,UAAKO,OAAL,GAAe,mEAAMD,oBAAN,iBAAkBL,MAAlB,EAA0B,QAA1B,CAAf;AACA,UAAKO,iBAAL,GAAyBN,gBAAzB;AACA,UAAKO,WAAL,GAAmB,oBAAnB;;AACA,UAAKJ,cAAL,CAAoBK,eAApB,CAAoC;AAClCC,MAAAA,GAAG,EAAE,MAAKF,WADwB;AAElCG,MAAAA,OAAO,EAAE,qCAAsB,MAAKC,WAA3B;AAFyB,KAApC;;AARM;AAYP;;;;;;;;;;;;sBAiBG,KAAKC,OAAL,IACA,KAAKT,cAAL,CAAoBU,KADpB,IAEA,KAAKR,OAAL,CAAaQ,K;;;;;AAEb,qBAAKC,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKL,WAAL,CAAiBM;AADL,iBAApB;;oBAGK,KAAKC,W;;;;;AACR,qBAAKC,UAAL,CAAgB,KAAKd,OAAL,CAAae,aAA7B;;;;;sBACS,KAAKF,WAAL,KAAqB,KAAKb,OAAL,CAAae,a;;;;;;uBACrC,KAAKf,OAAL,CAAagB,SAAb,CAAuB,KAAKH,WAA5B,C;;;AAER,qBAAKJ,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKL,WAAL,CAAiBW;AADL,iBAApB;;;;;;;;;;;;;;;;;;;;;gDAqBavB,M;;;;;;uBACT,KAAKM,OAAL,CAAagB,SAAb,CAAuBtB,MAAvB,C;;;AACN,qBAAKe,KAAL,CAAWC,QAAX,CAAoB;AAClBC,kBAAAA,IAAI,EAAE,KAAKL,WAAL,CAAiBQ,UADL;AAElBpB,kBAAAA,MAAM,EAANA;AAFkB,iBAApB;;;;;;;;;;;;;;;;;;wBAlDiB;AACjB,aAAO,IAAIwB,aAAJ,8BACFC,MAAM,CAACC,IAAP,CAAYC,oCAAZ,CADE,IAEL,YAFK,IAGJ,gBAHI,CAAP;AAID;;;wBAEa;AACZ,aAAO,4BAAgB;AACrBC,QAAAA,MAAM,EAAE,qCAAuB,KAAKhB,WAA5B;AADa,OAAhB,CAAP;AAGD;;;wBAsBY;AACX,aAAO,KAAKiB,KAAL,CAAWD,MAAlB;AACD;;;wBAEiB;AAChB,aAAO,KAAKxB,cAAL,CAAoB0B,OAApB,CAA4B,KAAKtB,WAAjC,CAAP;AACD;;;;EAhEyCuB,kB,4FAkEzCC,kB;;;;;;;WACkB,CACjB;AAAA,aAAM,MAAI,CAACzB,iBAAX;AAAA,KADiB,EAEjB,UAAA0B,CAAC;AAAA,aAAIA,CAAC,CAACC,KAAF,GAAUC,IAAV,EAAJ;AAAA,KAFgB,C;;gEAKlBC,gB","sourcesContent":["import { DEFAULT_LOCALE } from '@ringcentral-integration/i18n';\nimport { combineReducers } from 'redux';\nimport RcModule from '../../lib/RcModule';\nimport Enum from '../../lib/Enum';\nimport { moduleActionTypes } from '../../enums/moduleActionTypes';\nimport proxify from '../../lib/proxy/proxify';\nimport { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport { selector } from '../../lib/selector';\nimport getModuleStatusReducer from '../../lib/getModuleStatusReducer';\nimport { getSavedLocaleReducer } from './reducers';\n\n/* eslint-disable global-require */\n\n/**\n * @class\n * @description Locale managing module\n */\n@Module({\n  name: 'LocaleSettings',\n  deps: [\n    'GlobalStorage',\n    'Locale',\n    { dep: 'LocaleSettingsOptions', optional: true }\n  ]\n})\nexport default class LocaleSettings extends RcModule {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {String} params.defaultLocale - default 'en-US'\n   */\n  constructor({\n    globalStorage,\n    locale,\n    supportedLocales = [DEFAULT_LOCALE],\n    ...options\n  } = {}) {\n    super({\n      ...options,\n    });\n    this._globalStorage = this::ensureExist(globalStorage, 'globalStorage');\n    this._locale = this::ensureExist(locale, 'locale');\n    this._supportedLocales = supportedLocales;\n    this._storageKey = 'localeSettingsData';\n    this._globalStorage.registerReducer({\n      key: this._storageKey,\n      reducer: getSavedLocaleReducer(this.actionTypes),\n    });\n  }\n\n  get _actionTypes() {\n    return new Enum([\n      ...Object.keys(moduleActionTypes),\n      'saveLocale',\n    ], 'localeSettings');\n  }\n\n  get reducer() {\n    return combineReducers({\n      status: getModuleStatusReducer(this.actionTypes),\n    });\n  }\n\n  async _onStateChange() {\n    if (\n      this.pending &&\n      this._globalStorage.ready &&\n      this._locale.ready\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      if (!this.savedLocale) {\n        this.saveLocale(this._locale.currentLocale);\n      } else if (this.savedLocale !== this._locale.currentLocale) {\n        await this._locale.setLocale(this.savedLocale);\n      }\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    }\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get savedLocale() {\n    return this._globalStorage.getItem(this._storageKey);\n  }\n\n  @selector\n  supportedLocales = [\n    () => this._supportedLocales,\n    s => s.slice().sort(),\n  ];\n\n  @proxify\n  async saveLocale(locale) {\n    await this._locale.setLocale(locale);\n    this.store.dispatch({\n      type: this.actionTypes.saveLocale,\n      locale,\n    });\n  }\n}\n"],"file":"index.js"}