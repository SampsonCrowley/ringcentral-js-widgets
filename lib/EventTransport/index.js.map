{"version":3,"sources":["lib/EventTransport/index.js"],"names":["EventTransport","options","name","_deferred","Map","payload","requestId","uuid","v4","promise","Promise","resolve","reject","set","timeoutId","setTimeout","get","Error","_events","timeout","_timeout","then","result","clearTimeout","delete","catch","error","emit","request","deferred","push","TransportBase"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAGqBA,c;;;;;AACnB,0BAAYC,OAAZ,EAAqB;AAAA;;AAAA;;AACnB,0GACKA,OADL;AAEEC,MAAAA,IAAI,EAAE;AAFR;AAIA,UAAKC,SAAL,GAAiB,IAAIC,GAAJ,EAAjB;AALmB;AAMpB;;;;;;;;;;;;;;;AACeC,gBAAAA,O,QAAAA,O;AACRC,gBAAAA,S,GAAYC,cAAKC,EAAL,E;AACZC,gBAAAA,O,GAAU,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC/C,kBAAA,MAAI,CAACT,SAAL,CAAeU,GAAf,CAAmBP,SAAnB,EAA8B;AAC5BK,oBAAAA,OAAO,EAAPA,OAD4B;AAE5BC,oBAAAA,MAAM,EAANA;AAF4B,mBAA9B;AAID,iBALe,C;AAMZE,gBAAAA,S,GAAYC,UAAU,CAAC,YAAM;AAC/BD,kBAAAA,SAAS,GAAG,IAAZ;;AACA,kBAAA,MAAI,CAACX,SAAL,CAAea,GAAf,CAAmBV,SAAnB,EAA8BM,MAA9B,CAAqC,IAAIK,KAAJ,CAAU,MAAI,CAACC,OAAL,CAAaC,OAAvB,CAArC;AACD,iBAHyB,EAGvB,KAAKC,QAHkB,C;AAI1BX,gBAAAA,OAAO,CAACY,IAAR,CAAa,UAACC,MAAD,EAAY;AACvB,sBAAIR,SAAJ,EAAeS,YAAY,CAACT,SAAD,CAAZ;;AACf,kBAAA,MAAI,CAACX,SAAL,CAAeqB,MAAf,CAAsBlB,SAAtB;;AACA,yBAAOI,OAAO,CAACC,OAAR,CAAgBW,MAAhB,CAAP;AACD,iBAJD,EAIGG,KAJH,CAIS,UAACC,KAAD,EAAW;AAClB,sBAAIZ,SAAJ,EAAeS,YAAY,CAACT,SAAD,CAAZ;;AACf,kBAAA,MAAI,CAACX,SAAL,CAAeqB,MAAf,CAAsBlB,SAAtB;;AACA,yBAAOI,OAAO,CAACE,MAAR,CAAec,KAAf,CAAP;AACD,iBARD;AASA,qBAAKC,IAAL,CAAU,KAAKT,OAAL,CAAaU,OAAvB,EAAgC;AAC9BtB,kBAAAA,SAAS,EAATA,SAD8B;AAE9BD,kBAAAA,OAAO,EAAPA;AAF8B,iBAAhC;iDAIOI,O;;;;;;;;;;;;;;;;;;oCAE8B;AAAA,UAA5BH,SAA4B,SAA5BA,SAA4B;AAAA,UAAjBgB,MAAiB,SAAjBA,MAAiB;AAAA,UAATI,KAAS,SAATA,KAAS;;AACrC,UAAMG,QAAQ,GAAG,KAAK1B,SAAL,CAAea,GAAf,CAAmBV,SAAnB,CAAjB;;AACA,UAAIuB,QAAJ,EAAc;AACZ,YAAIH,KAAJ,EAAW;AACTG,UAAAA,QAAQ,CAACjB,MAAT,CAAgBc,KAAhB;AACD,SAFD,MAEO;AACLG,UAAAA,QAAQ,CAAClB,OAAT,CAAiBW,MAAjB;AACD;AACF;AACF;;;gCACiB;AAAA,UAAXjB,OAAW,SAAXA,OAAW;AAChB,WAAKsB,IAAL,CAAU,KAAKT,OAAL,CAAaY,IAAvB,EAA6BzB,OAA7B;AACD;;;;EA/CyC0B,uB","sourcesContent":["import uuid from 'uuid';\nimport TransportBase from '../TransportBase';\n\n\nexport default class EventTransport extends TransportBase {\n  constructor(options) {\n    super({\n      ...options,\n      name: 'EventTransport',\n    });\n    this._deferred = new Map();\n  }\n  async request({ payload }) {\n    const requestId = uuid.v4();\n    const promise = new Promise((resolve, reject) => {\n      this._deferred.set(requestId, {\n        resolve,\n        reject,\n      });\n    });\n    let timeoutId = setTimeout(() => {\n      timeoutId = null;\n      this._deferred.get(requestId).reject(new Error(this._events.timeout));\n    }, this._timeout);\n    promise.then((result) => {\n      if (timeoutId) clearTimeout(timeoutId);\n      this._deferred.delete(requestId);\n      return Promise.resolve(result);\n    }).catch((error) => {\n      if (timeoutId) clearTimeout(timeoutId);\n      this._deferred.delete(requestId);\n      return Promise.reject(error);\n    });\n    this.emit(this._events.request, {\n      requestId,\n      payload,\n    });\n    return promise;\n  }\n  response({ requestId, result, error }) {\n    const deferred = this._deferred.get(requestId);\n    if (deferred) {\n      if (error) {\n        deferred.reject(error);\n      } else {\n        deferred.resolve(result);\n      }\n    }\n  }\n  push({ payload }) {\n    this.emit(this._events.push, payload);\n  }\n}\n"],"file":"index.js"}