{"version":3,"sources":["modules/GlipGroups/index.js"],"names":["glipGroupRegExp","subscriptionFilter","DEFAULT_PER_PAGE","DEFAULT_TTL","DEFAULT_RETRY","DEFAULT_RECORD_COUNT_PER_REQ","DEFAULT_PRELOAD_POSTS_DELAY_TTL","formatGroup","group","personsMap","postsMap","ownerId","id","detailMembers","members","forEach","memberId","push","isMe","newGroup","updatedTime","Date","lastModifiedTime","getTime","latestPost","creator","creatorId","postCreationTime","creationTime","getUniqueMemberIds","groups","memberIds","memberIdsMap","GlipGroups","deps","dep","optional","auth","subscription","client","tabManager","glipPersons","glipPosts","storage","connectivityMonitor","timeToRetry","ttl","polling","disableCache","perPage","recordCountPerReq","preloadPosts","preloadPostsDelayTtl","options","actionTypes","_auth","ensureExist","_client","_subscription","_connectivityMonitor","_glipPersons","_glipPosts","_tabManager","_ttl","_timeToRetry","_polling","_perPage","_recordCountPerReq","_preloadPosts","_preloadedPosts","_preloadPostsDelayTtl","_promise","_lastMessage","_subscriptionFilters","_storage","_dataStorageKey","_timestampStorageKey","_reducer","registerReducer","key","reducer","timestamp","data","addNewPostListener","onNewPost","post","store","subscribe","_onStateChange","_shouldInit","dispatch","type","init","_init","_isDataReady","initSuccess","_onDataReady","_shouldReset","_clearTimeout","resetSuccess","_shouldSubscribe","_processSubscription","ready","_connectivity","connectivity","fetchData","_preloadGroupPosts","loggedIn","_readyCheckFn","pending","message","loadPersons","groupMemberIds","test","event","body","eventType","removeGroup","updateGroup","loadPosts","active","status","moduleStatuses","initializing","_shouldFetch","console","error","_retry","_startPolling","_subscriptionHandleFn","force","slice","fetchPosts","readTimeMap","updateReadTime","now","searchFilter","pageNumber","updateFilter","length","groupId","lastGroupId","currentGroupId","lastGroupPosts","currentGroupPosts","updateCurrentGroupId","currentGroup","glip","list","recordCount","result","fetch","_fetchFunction","fetchSuccess","fetchError","_fetchData","personId","name","isPublic","description","state","getItem","Pollable","proxify","getter","map","allGroups","filterString","toLowerCase","filter","indexOf","groupUsernames","m","firstName","lastName","join","filteredGroups","sortedGroups","sort","a","b","noTeamGroups","g","find","undefined","posts","reversePosts","reverse","sentByMe","readTime","unread"],"mappings":"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","file":"index.js","sourcesContent":["import { createSelector } from 'reselect';\n\nimport { Module } from '../../lib/di';\nimport Pollable from '../../lib/Pollable';\nimport isBlank from '../../lib/isBlank';\nimport sleep from '../../lib/sleep';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport ensureExist from '../../lib/ensureExist';\nimport getter from '../../lib/getter';\nimport proxify from '../../lib/proxy/proxify';\n\nimport getReducer, {\n  getDataReducer,\n  getTimestampReducer,\n} from './getReducer';\nimport actionTypes from './actionTypes';\n\nconst glipGroupRegExp = /glip\\/groups$/;\nconst subscriptionFilter = '/glip/groups';\n\nconst DEFAULT_PER_PAGE = 20;\nconst DEFAULT_TTL = 30 * 60 * 1000;\nconst DEFAULT_RETRY = 62 * 1000;\nconst DEFAULT_RECORD_COUNT_PER_REQ = 250;\nconst DEFAULT_PRELOAD_POSTS_DELAY_TTL = 800;\n\nfunction formatGroup(group, personsMap, postsMap = {}, ownerId) {\n  if (!group || !group.id) {\n    return {};\n  }\n  const detailMembers = [];\n  if (group.members) {\n    group.members.forEach((memberId) => {\n      if (personsMap[memberId]) {\n        detailMembers.push({\n          ...personsMap[memberId],\n          isMe: ownerId === memberId,\n        });\n      }\n    });\n  }\n  const newGroup = {\n    ...group,\n    detailMembers,\n    updatedTime: (new Date(group.lastModifiedTime)).getTime(),\n  };\n  const latestPost =\n    postsMap[group.id] && postsMap[group.id][0];\n  if (latestPost) {\n    newGroup.latestPost = {\n      ...latestPost,\n      creator: personsMap[latestPost.creatorId],\n    };\n    const postCreationTime = (new Date(latestPost.creationTime)).getTime();\n    if (postCreationTime > newGroup.updatedTime) {\n      newGroup.updatedTime = postCreationTime;\n    }\n  }\n  return newGroup;\n}\n\nfunction getUniqueMemberIds(groups) {\n  const memberIds = [];\n  const memberIdsMap = {};\n  groups.forEach((group) => {\n    group.members.forEach((memberId) => {\n      if (memberIdsMap[memberId]) {\n        return;\n      }\n      memberIdsMap[memberId] = true;\n      memberIds.push(memberId);\n    });\n  });\n  return memberIds;\n}\n\n/**\n * @class\n * @description Accound info managing module.\n */\n@Module({\n  deps: [\n    'Auth',\n    'Client',\n    'Subscription',\n    { dep: 'ConnectivityMonitor', optional: true },\n    { dep: 'Storage', optional: true },\n    { dep: 'TabManager', optional: true },\n    { dep: 'GlipPersons', optional: true },\n    { dep: 'GlipPosts', optional: true },\n    { dep: 'GLipGroupsOptions', optional: true }\n  ]\n})\nexport default class GlipGroups extends Pollable {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Client} params.client - client module instance\n   * @param {Auth} params.auth - auth module instance\n   * @param {Subscription} params.subscription - subscription module instance\n   * @param {TabManager} params.tabManager - tabManager module instance\n   * @param {GlipPersons} params.glipPersons - glipPersons module instance\n   * @param {GlipPosts} params.glipPosts - glipPosts module instance\n   * @param {Storage} params.storage - storage module instance\n   */\n  constructor({\n    auth,\n    subscription,\n    client,\n    tabManager,\n    glipPersons,\n    glipPosts,\n    storage,\n    connectivityMonitor,\n    timeToRetry = DEFAULT_RETRY,\n    ttl = DEFAULT_TTL,\n    polling = false,\n    disableCache = false,\n    perPage = DEFAULT_PER_PAGE,\n    recordCountPerReq = DEFAULT_RECORD_COUNT_PER_REQ,\n    preloadPosts = true,\n    preloadPostsDelayTtl = DEFAULT_PRELOAD_POSTS_DELAY_TTL,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = this::ensureExist(auth, 'auth');\n    this._client = this::ensureExist(client, 'client');\n    this._subscription = this::ensureExist(subscription, 'subscription');\n    this._connectivityMonitor = connectivityMonitor;\n    this._glipPersons = glipPersons;\n    this._glipPosts = glipPosts;\n    this._tabManager = tabManager;\n\n    this._ttl = ttl;\n    this._timeToRetry = timeToRetry;\n    this._polling = polling;\n    this._perPage = perPage;\n    this._recordCountPerReq = recordCountPerReq;\n    this._preloadPosts = preloadPosts;\n    this._preloadedPosts = {};\n    this._preloadPostsDelayTtl = preloadPostsDelayTtl;\n\n    this._promise = null;\n    this._lastMessage = null;\n\n    this._subscriptionFilters = [subscriptionFilter];\n    if (!disableCache) {\n      this._storage = storage;\n    }\n\n    this._dataStorageKey = 'glipGroupsData';\n    this._timestampStorageKey = 'glipGroupsTimestamp';\n\n    if (this._storage) {\n      this._reducer = getReducer(this.actionTypes);\n\n      this._storage.registerReducer({\n        key: this._dataStorageKey,\n        reducer: getDataReducer(this.actionTypes),\n      });\n      this._storage.registerReducer({\n        key: this._timestampStorageKey,\n        reducer: getTimestampReducer(this.actionTypes),\n      });\n    } else {\n      this._reducer = getReducer(this.actionTypes, {\n        timestamp: getTimestampReducer(this.actionTypes),\n        data: getDataReducer(this.actionTypes),\n      });\n    }\n\n    if (this._glipPosts) {\n      this._glipPosts.addNewPostListener(post => this.onNewPost(post));\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  async _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      await this._init();\n    } else if (this._isDataReady()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n      this._onDataReady();\n    } else if (this._shouldReset()) {\n      this._clearTimeout();\n      this._promise = null;\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    } else if (this._shouldSubscribe()) {\n      this._processSubscription();\n    } else if (\n      this.ready &&\n      this._connectivityMonitor &&\n      this._connectivityMonitor.ready &&\n      this._connectivity !== this._connectivityMonitor.connectivity\n    ) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n      if (!this._connectivity) {\n        return;\n      }\n      await this.fetchData();\n      if (this._preloadPosts) {\n        this._preloadedPosts = {};\n        this._preloadGroupPosts(true);\n      }\n    }\n  }\n\n  _shouldInit() {\n    return !!(\n      this._auth.loggedIn &&\n      (!this._connectivityMonitor || this._connectivityMonitor.ready) &&\n      (!this._storage || this._storage.ready) &&\n      (!this._readyCheckFn || this._readyCheckFn()) &&\n      (!this._subscription || this._subscription.ready) &&\n      (!this._glipPosts || this._glipPosts.ready) &&\n      (!this._glipPersons || this._glipPersons.ready) &&\n      (!this._tabManager || this._tabManager.ready) &&\n      this.pending\n    );\n  }\n\n  _shouldReset() {\n    return !!(\n      (\n        !this._auth.loggedIn ||\n        (this._storage && !this._storage.ready) ||\n        (this._readyCheckFn && !this._readyCheckFn()) ||\n        (this._subscription && !this._subscription.ready) ||\n        (this._glipPosts && !this._glipPosts.ready) ||\n        (this._glipPersons && !this._glipPersons.ready) ||\n        (this._connectivityMonitor && !this._connectivityMonitor.ready) ||\n        (this._tabManager && !this._tabManager.ready)\n      ) &&\n      this.ready\n    );\n  }\n\n  _shouldSubscribe() {\n    return !!(\n      this.ready &&\n      this._subscription &&\n      this._subscription.ready &&\n      this._subscription.message &&\n      this._subscription.message !== this._lastMessage\n    );\n  }\n\n  _onDataReady() {\n    if (this._glipPersons) {\n      this._glipPersons.loadPersons(this.groupMemberIds);\n    }\n    if (this._preloadPosts) {\n      this._preloadedPosts = {};\n      this._preloadGroupPosts();\n    }\n  }\n\n  async _subscriptionHandleFn(message) {\n    if (\n      message &&\n      glipGroupRegExp.test(message.event) &&\n      message.body\n    ) {\n      const {\n        eventType,\n        ...group\n      } = message.body;\n      if (eventType === 'GroupLeft') {\n        this.store.dispatch({\n          type: this.actionTypes.removeGroup,\n          group,\n        });\n        return;\n      }\n      this.store.dispatch({\n        type: this.actionTypes.updateGroup,\n        group,\n      });\n      if (this._glipPersons) {\n        this._glipPersons.loadPersons(group.members);\n      }\n      this._glipPosts.loadPosts(group.id);\n    }\n  }\n\n  _shouldFetch() {\n    return (\n      !this._tabManager || this._tabManager.active\n    );\n  }\n\n  _isDataReady() {\n    return this.status === moduleStatuses.initializing &&\n      this.timestamp !== null;\n  }\n\n  async _init() {\n    if (this._shouldFetch()) {\n      try {\n        await this.fetchData();\n      } catch (e) {\n        console.error('fetchData error:', e);\n        this._retry();\n      }\n    } else if (this._polling) {\n      this._startPolling();\n    } else {\n      this._retry();\n    }\n    if (this._subscription && this._subscriptionFilters) {\n      this._subscription.subscribe(this._subscriptionFilters);\n    }\n    if (this._connectivityMonitor) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n    }\n  }\n\n  _processSubscription() {\n    this._lastMessage = this._subscription.message;\n    this._subscriptionHandleFn(this._lastMessage);\n  }\n\n  async _preloadGroupPosts(force) {\n    const groups = this.groups.slice(0, 20);\n    for (const group of groups) {\n      if (!this._glipPosts) {\n        break;\n      }\n      if (this._preloadedPosts[group.id]) {\n        continue;\n      }\n      this._preloadedPosts[group.id] = true;\n      if (!this._glipPosts.postsMap[group.id] || force) {\n        await sleep(this._preloadPostsDelayTtl);\n        if (!this._glipPosts.postsMap[group.id] || force) {\n          await this._glipPosts.fetchPosts(group.id);\n        }\n      }\n      if (!this._glipPosts.readTimeMap[group.id]) {\n        this._glipPosts.updateReadTime(group.id, (Date.now() - (1000 * 3600 * 2)));\n      }\n    }\n  }\n\n  @proxify\n  updateFilter({ searchFilter, pageNumber }) {\n    this.store.dispatch({\n      type: this.actionTypes.updateFilter,\n      searchFilter,\n      pageNumber,\n    });\n    if (this._preloadPosts && this.groups.length <= this._perPage * 2) {\n      this._preloadGroupPosts();\n    }\n  }\n\n  @proxify\n  updateCurrentGroupId(groupId) {\n    if (!groupId) {\n      return;\n    }\n    const lastGroupId = this.currentGroupId;\n    const lastGroupPosts = this.currentGroupPosts;\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentGroupId,\n      groupId,\n    });\n    if (this._glipPersons) {\n      this._glipPersons.loadPersons(\n        this.currentGroup && this.currentGroup.members\n      );\n    }\n    if (!this._glipPosts) {\n      return;\n    }\n    if (lastGroupPosts.length > 20) {\n      this._glipPosts.fetchPosts(lastGroupId);\n    }\n    this._glipPosts.loadPosts(groupId);\n    this._glipPosts.updateReadTime(groupId);\n  }\n\n  async _fetchFunction() {\n    const result = await this._client.glip().groups().list({\n      recordCount: this._recordCountPerReq,\n    });\n    return result;\n  }\n\n  async _fetchData() {\n    this.store.dispatch({\n      type: this.actionTypes.fetch,\n    });\n    const { ownerId } = this._auth;\n    try {\n      const data = await this._fetchFunction();\n      if (this._auth.ownerId === ownerId) {\n        this.store.dispatch({\n          type: this.actionTypes.fetchSuccess,\n          data,\n          timestamp: Date.now(),\n        });\n        if (this._polling) {\n          this._startPolling();\n        }\n        this._promise = null;\n      }\n    } catch (error) {\n      if (this._auth.ownerId === ownerId) {\n        this._promise = null;\n        this.store.dispatch({\n          type: this.actionTypes.fetchError,\n          error,\n        });\n        if (this._polling) {\n          this._startPolling(this.timeToRetry);\n        } else {\n          this._retry();\n        }\n        throw error;\n      }\n    }\n  }\n\n  @proxify\n  async fetchData() {\n    if (!this._promise) {\n      this._promise = this._fetchData();\n    }\n    return this._promise;\n  }\n\n  @proxify\n  async startChat(personId) {\n    try {\n      const group = await this._client.glip().groups().post({\n        type: 'PrivateChat',\n        members: [this._auth.ownerId, personId]\n      });\n      group.lastModifiedTime = Date.now();\n      this.store.dispatch({\n        type: this.actionTypes.updateGroup,\n        group,\n      });\n      this.store.dispatch({\n        type: this.actionTypes.updateCurrentGroupId,\n        groupId: group.id,\n      });\n      return group;\n    } catch (e) {\n      console.error(e);\n    }\n    return null;\n  }\n\n  onNewPost(post) {\n    if (post.groupId === this.currentGroupId && this._glipPosts) {\n      this._glipPosts.updateReadTime(post.groupId);\n    }\n  }\n\n  async createTeam(name, members, type = 'Team') {\n    const group = await this._client.glip().groups().post({\n      type,\n      name,\n      members,\n      isPublic: true,\n      description: ''\n    });\n    return group.id;\n  }\n\n  @getter\n  allGroups = createSelector(\n    () => this.data,\n    () => (this._glipPersons && this._glipPersons.personsMap) || {},\n    () => (this._glipPosts && this._glipPosts.postsMap) || {},\n    () => this._auth.ownerId,\n    (data, personsMap, postsMap, ownerId) => (data || []).map(\n      group => formatGroup(group, personsMap, postsMap, ownerId)\n    ),\n  )\n\n  @getter\n  filteredGroups = createSelector(\n    () => this.allGroups,\n    () => this.searchFilter,\n    (allGroups, searchFilter) => {\n      if (isBlank(searchFilter)) {\n        return allGroups;\n      }\n      const filterString = searchFilter.toLowerCase();\n      return allGroups.filter((group) => {\n        const name = group.name && group.name.toLowerCase();\n        if (name && name.indexOf(filterString) > -1) {\n          return true;\n        }\n        if (!name) {\n          const groupUsernames = group.detailMembers\n            .map(m => `${m.firstName} ${m.lastName}`)\n            .join(',')\n            .toLowerCase();\n          if (groupUsernames && groupUsernames.indexOf(filterString) > -1) {\n            return true;\n          }\n        }\n        return false;\n      });\n    },\n  )\n\n  @getter\n  groups = createSelector(\n    () => this.filteredGroups,\n    (filteredGroups) => {\n      const sortedGroups =\n        filteredGroups.sort((a, b) => {\n          if (a.updatedTime === b.updatedTime) return 0;\n          return a.updatedTime > b.updatedTime ?\n            -1 :\n            1;\n        });\n      return sortedGroups;\n    },\n  )\n\n  @getter\n  uniqueMemberIds = createSelector(\n    () => this.allGroups,\n    getUniqueMemberIds,\n  )\n\n  @getter\n  groupMemberIds = createSelector(\n    () => this.allGroups,\n    (groups) => {\n      const noTeamGroups = groups.filter(g => g.type !== 'Team');\n      return getUniqueMemberIds(noTeamGroups);\n    },\n  )\n\n  @getter\n  currentGroup = createSelector(\n    () => this.allGroups,\n    () => this.currentGroupId,\n    () => (this._glipPersons && this._glipPersons.personsMap) || {},\n    (allGroups, currentGroupId, personsMap) => {\n      const group = allGroups.find(g => g.id === currentGroupId) || {};\n      return formatGroup(group, personsMap, undefined, this._auth.ownerId);\n    },\n  )\n\n  @getter\n  currentGroupPosts = createSelector(\n    () => {\n      const postsMap = (this._glipPosts && this._glipPosts.postsMap) || {};\n      return postsMap[this.currentGroupId];\n    },\n    () => (this._glipPersons && this._glipPersons.personsMap) || {},\n    (posts, personsMap) => {\n      // const posts = postsMap[currentGroupId] || [];\n      const reversePosts = (posts || []).slice(0).reverse();\n      return reversePosts.map((post) => {\n        const creator = personsMap[post.creatorId];\n        return {\n          ...post,\n          sentByMe: post.creatorId === this._auth.ownerId,\n          creator,\n        };\n      });\n    },\n  )\n\n  @getter\n  groupsWithUnread = createSelector(\n    () => this.groups,\n    () => (this._glipPosts && this._glipPosts.postsMap) || {},\n    () => (this._glipPosts && this._glipPosts.readTimeMap) || {},\n    (groups, postsMap, readTimeMap) => groups.map((group) => {\n      const posts = postsMap[group.id] || [];\n      const readTime = readTimeMap[group.id] || Date.now();\n      return {\n        ...group,\n        unread:\n          posts.filter(post =>\n            (new Date(post.creationTime)).getTime() > readTime &&\n            post.creatorId !== this._auth.ownerId\n          ).length\n      };\n    })\n  )\n\n  get searchFilter() {\n    return this.state.searchFilter;\n  }\n\n  get data() {\n    return this._storage ?\n      this._storage.getItem(this._dataStorageKey) :\n      this.state.data;\n  }\n\n  get timestamp() {\n    return this._storage ?\n      this._storage.getItem(this._timestampStorageKey) :\n      this.state.timestamp;\n  }\n\n  get currentGroupId() {\n    return this.state.currentGroupId;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  get pending() {\n    return this.status === moduleStatuses.pending;\n  }\n\n  get ttl() {\n    return this._ttl;\n  }\n\n  get timeToRetry() {\n    return this._timeToRetry;\n  }\n}\n"]}