{"version":3,"sources":["modules/DialerUI/index.js"],"names":["getToNumberFieldReducer","types","state","type","phoneNumber","setToNumberField","loadLastCallState","call","setRecipient","clearToNumberField","resetSuccess","callSuccess","getRecipientReducer","recipient","clearRecipient","DialerUI","name","deps","dep","optional","alert","options","_call","ensureExist","_alert","_storageKey","_callHooks","pending","ready","store","dispatch","actionTypes","init","initSuccess","reset","toNumberField","shouldClean","fromNumber","hook","callError","error","beforeCall","trim","length","lastRecipient","lastPhoneNumber","warning","message","callErrors","noToNumber","Enum","moduleActionTypes","status","_storage","getItem","RcModule","proxify"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from 'ringcentral-integration/lib/RcModule';\nimport Enum from 'ringcentral-integration/lib/Enum';\nimport { Module } from 'ringcentral-integration/lib/di';\nimport { combineReducers } from 'redux';\nimport proxify from 'ringcentral-integration/lib/proxy/proxify';\nimport ensureExist from 'ringcentral-integration/lib/ensureExist';\nimport getModuleStatusReducer from 'ringcentral-integration/lib/getModuleStatusReducer';\nimport moduleActionTypes from 'ringcentral-integration/enums/moduleActionTypes';\nimport callErrors from 'ringcentral-integration/modules/Call/callErrors';\n\nfunction getToNumberFieldReducer(types) {\n  return (state = '', { type, phoneNumber }) => {\n    switch (type) {\n      case types.setToNumberField:\n      case types.loadLastCallState:\n      case types.call:\n        return phoneNumber;\n      case types.setRecipient:\n      case types.clearToNumberField:\n      case types.resetSuccess:\n      case types.callSuccess:\n        return '';\n      default:\n        return state;\n    }\n  };\n}\n\nfunction getRecipientReducer(types) {\n  return (state = null, { type, recipient }) => {\n    switch (type) {\n      case types.setRecipient:\n      case types.loadLastCallState:\n      case types.call:\n        return recipient;\n      case types.clearRecipient:\n      case types.resetSuccess:\n      case types.callSuccess:\n        return null;\n      default:\n        return state;\n    }\n  };\n}\n\n@Module({\n  name: 'DialerUI',\n  deps: [\n    'Call',\n    'Alert',\n    { dep: 'DialerUIOptions', optional: true },\n  ],\n})\nexport default class DialerUI extends RcModule {\n  constructor({\n    call,\n    alert,\n    ...options\n  }) {\n    super({\n      ...options,\n    });\n    this._call = this:: ensureExist(call, 'call');\n    this._alert = this::ensureExist(alert, 'alert');\n    this._storageKey = 'dialerUIData';\n    this._callHooks = [];\n  }\n\n  get _actionTypes() {\n    return new Enum([\n      ...Object.keys(moduleActionTypes),\n      'setToNumberField',\n      'clearToNumberField',\n      'setRecipient',\n      'clearRecipient',\n      'loadLastCallState',\n      'call',\n      'callError',\n      'callSuccess',\n    ], 'dialerUI');\n  }\n\n\n  get reducer() {\n    return combineReducers({\n      status: getModuleStatusReducer(this.actionTypes),\n      toNumberField: getToNumberFieldReducer(this.actionTypes),\n      recipient: getRecipientReducer(this.actionTypes),\n    });\n  }\n\n  async _onStateChange() {\n    if (\n      this.pending &&\n      this._call.ready\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (\n      this.ready &&\n      (\n        !this._call.ready\n      )\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.reset,\n      });\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    }\n  }\n\n  @proxify\n  async clearToNumberField() {\n    this.store.dispatch({\n      type: this.actionTypes.clearToNumberField,\n    });\n  }\n\n  @proxify\n  async setToNumberField(phoneNumber) {\n    if (this.toNumberField !== phoneNumber) {\n      this.store.dispatch({\n        type: this.actionTypes.setToNumberField,\n        phoneNumber,\n      });\n    }\n  }\n\n  @proxify\n  async setRecipient(recipient, shouldClean = true) {\n    this.store.dispatch({\n      type: this.actionTypes.setRecipient,\n      recipient,\n    });\n    if (shouldClean) {\n      await this.clearToNumberField();\n    }\n  }\n  @proxify\n  async clearRecipient() {\n    this.store.dispatch({\n      type: this.actionTypes.clearRecipient,\n    });\n  }\n\n  @proxify\n  async call({\n    phoneNumber = '',\n    recipient = null,\n    fromNumber = null,\n  }) {\n    if (phoneNumber || recipient) {\n      this.store.dispatch({\n        type: this.actionTypes.call,\n        phoneNumber,\n        recipient,\n      });\n      for (const hook of this._callHooks) {\n        await hook({\n          phoneNumber,\n          recipient,\n          fromNumber,\n        });\n      }\n      try {\n        await this._call.call({\n          phoneNumber: this.toNumberField,\n          recipient: this.recipient,\n          fromNumber,\n        });\n        this.store.dispatch({\n          type: this.actionTypes.callSuccess,\n        });\n      } catch (error) {\n        this.store.dispatch({\n          type: this.actionTypes.callError,\n          error,\n        });\n      }\n    }\n  }\n\n  @proxify\n  async onCallButtonClick({ fromNumber, beforeCall } = {}) {\n    if (\n      `${this.toNumberField}`.trim().length === 0 &&\n      !this.recipient\n    ) {\n      if (!this._call.lastRecipient && !this._call.lastPhoneNumber) {\n        this._alert.warning({\n          message: callErrors.noToNumber,\n        });\n      } else {\n        this.store.dispatch({\n          type: this.actionTypes.loadLastCallState,\n          phoneNumber: this._call.lastPhoneNumber,\n          recipient: this._call.lastRecipient,\n        });\n      }\n    } else {\n      if (typeof beforeCall === 'function') {\n        beforeCall();\n      }\n      await this.call({\n        phoneNumber: this.toNumberField,\n        recipient: this.recipient,\n        fromNumber,\n      });\n    }\n  }\n\n  get lastDialedState() {\n    return this._storage.getItem(this._storageKey);\n  }\n\n  get toNumberField() {\n    return this.state.toNumberField;\n  }\n\n  get recipient() {\n    return this.state.recipient;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n}\n"]}