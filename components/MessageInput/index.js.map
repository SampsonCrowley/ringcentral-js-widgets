{"version":3,"sources":["components/MessageInput/index.js"],"names":["UIHeightOffset","MessageInput","props","context","onChange","e","value","currentTarget","newHeight","calculateNewHeight","state","height","onHeightChange","setState","onKeyDown","key","shiftKey","preventDefault","onSend","disabled","minHeight","nextProps","inputExpandable","textArea","style","scrollHeight","maxHeight","currentLocale","maxLength","inputHeight","styles","root","textField","target","i18n","getString","submitField","sendButton","Component","propTypes","PropTypes","string","isRequired","bool","number","func","defaultProps","undefined"],"mappings":"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","sourcesContent":["import PropTypes from 'prop-types';\nimport React, { Component } from 'react';\n\nimport i18n from './i18n';\nimport styles from './styles.scss';\n\nconst UIHeightOffset = 23;\n// the extra height of the entire field with paddings and borders\n\nexport default class MessageInput extends Component {\n  static propTypes = {\n    value: PropTypes.string.isRequired,\n    currentLocale: PropTypes.string.isRequired,\n    disabled: PropTypes.bool,\n    minHeight: PropTypes.number,\n    maxHeight: PropTypes.number,\n    maxLength: PropTypes.number,\n    onSend: PropTypes.func,\n    onChange: PropTypes.func,\n    onHeightChange: PropTypes.func,\n    inputExpandable: PropTypes.bool,\n  }\n\n  static defaultProps = {\n    disabled: false,\n    onSend: undefined,\n    onChange: undefined,\n    onHeightChange: undefined,\n    minHeight: 63,\n    maxHeight: 300,\n    maxLength: 5000,\n    inputExpandable: true,\n  }\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      value: props.value,\n      height: props.minHeight,\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.value !== this.state.value) {\n      // use setState(updater, callback) to recaculate height after value has been update to DOM\n      this.setState(\n        () => ({\n          value: nextProps.value,\n        }),\n        () => {\n          const newHeight = this.calculateNewHeight();\n          if (newHeight !== this.state.height) {\n            if (typeof this.props.onHeightChange === 'function') {\n              this.props.onHeightChange(newHeight);\n            }\n            this.setState({\n              height: newHeight,\n            });\n          }\n        }\n      );\n    }\n  }\n\n  componentDidMount() {\n    // do a initial size check in case the component is mounted with multi line value\n    const newHeight = this.calculateNewHeight();\n    if (newHeight !== this.state.height) {\n      if (typeof this.props.onHeightChange === 'function') {\n        this.props.onHeightChange(newHeight);\n      }\n      this.setState({\n        height: newHeight,\n      });\n    }\n  }\n\n  calculateNewHeight() {\n    if (!this.props.inputExpandable) {\n      return this.props.minHeight;\n    }\n    // temperarily set height to 0 to check scrollHeight\n    this.textArea.style.height = 0;\n    const newHeight = this.textArea.scrollHeight + 10 + UIHeightOffset;\n    // set height back to original to avoid messing with react\n    this.textArea.style.height = `${this.state.height - UIHeightOffset}px`;\n    const {\n      minHeight,\n      maxHeight,\n    } = this.props;\n    if (newHeight < minHeight) {\n      return minHeight;\n    } if (newHeight > maxHeight) {\n      return maxHeight;\n    }\n    return newHeight;\n  }\n\n  onChange = (e) => {\n    const {\n      currentTarget: {\n        value,\n      },\n    } = e;\n    const newHeight = this.calculateNewHeight();\n    if (newHeight !== this.state.height && typeof this.props.onHeightChange === 'function') {\n      this.props.onHeightChange(newHeight);\n    }\n    this.setState({\n      value,\n      height: newHeight,\n    });\n    if (typeof this.props.onChange === 'function') {\n      this.props.onChange(value);\n    }\n  }\n\n  onKeyDown = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      this.onSend();\n    }\n  }\n\n  onSend = () => {\n    if (\n      !this.props.disabled &&\n      typeof this.props.onSend === 'function'\n    ) {\n      this.props.onSend();\n    }\n  }\n\n  render() {\n    const {\n      currentLocale,\n      disabled,\n      maxLength,\n    } = this.props;\n    const {\n      value,\n      height,\n    } = this.state;\n    const inputHeight = height - UIHeightOffset;\n    return (\n      <div className={styles.root}>\n        <div className={styles.textField}>\n          <textarea\n            data-sign=\"messageInput\"\n            ref={(target) => { this.textArea = target; }}\n            placeholder={i18n.getString('typeMessage', currentLocale)}\n            value={value}\n            maxLength={maxLength}\n            onChange={this.onChange}\n            onKeyPressCapture={this.onKeyDown}\n            style={{\n              height: inputHeight,\n            }}\n          />\n        </div>\n        <div className={styles.submitField}>\n          <input\n            data-sign=\"messageButton\"\n            type=\"button\"\n            value={i18n.getString('send', currentLocale)}\n            onClick={this.onSend}\n            className={styles.sendButton}\n            disabled={disabled}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n"],"file":"index.js"}