{"version":3,"sources":["containers/SimpleActiveCallCtrlPage/index.js"],"names":["mapToProps","_","phone","activeCallControl","regionSettings","callMonitor","locale","brand","params","renderContactName","sessionId","activeSession","nameMatches","direction","callDirections","outbound","toMatches","fromMatches","phoneNumber","to","from","fallBackName","i18n","getString","currentLocale","fallBackNameFromThirdParty","fallBackNumber","areaCode","countryCode","otherDeviceCalls","fullName","mapToFunctions","routerInteraction","onBackButtonClick","goBack","setActiveSessionId","onTransfer","push","ActiveCallControlPanel","props","state","selectedMatcherIndex","onMute","mute","onUnmute","unmute","onHold","hold","onUnhold","unHold","onHangup","hangUp","formatPhone","onSelectMatcherName","option","findIndex","match","id","setState","loadActCall","nextProps","muteCtrl","ACTIONS_CTRL_MAP","transferCtrl","holdCtrl","callCtrlLayouts","normalCtrl","startTime","isOnMute","isOnHold","showContactDisplayPlaceholder","Component","propTypes","PropTypes","func","string","isRequired","object","array","bool","defaultProps"],"mappings":"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","sourcesContent":["/**\n * @file simplify active call control page\n * detail: https://jira.ringcentral.com/browse/RCINT-8256\n */\n\nimport { connect } from 'react-redux';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\nimport callDirections from 'ringcentral-integration/enums/callDirections';\n\nimport withPhone from '../../lib/withPhone';\n\nimport CallCtrlPanel from '../../components/CallCtrlPanel';\nimport callCtrlLayouts from '../../enums/callCtrlLayouts';\nimport { ACTIONS_CTRL_MAP } from '../../components/ActiveCallPad';\nimport i18n from './i18n';\nimport { pickFallBackInfo } from './utils';\n\nfunction mapToProps(_, {\n  phone: {\n    activeCallControl,\n    regionSettings,\n    callMonitor,\n    locale,\n    brand,\n  },\n  params,\n  renderContactName,\n}) {\n  const { sessionId } = params;\n  const { activeSession } = activeCallControl;\n  let nameMatches = [];\n  if (activeSession && !renderContactName) {\n    nameMatches =\n      activeSession.direction === callDirections.outbound ?\n        activeSession.toMatches : activeSession.fromMatches;\n  }\n  let phoneNumber;\n  if (activeSession) {\n    phoneNumber = activeSession.direction === callDirections.outbound ?\n      activeSession.to : activeSession.from;\n  }\n  let fallBackName = i18n.getString('Unknown', locale.currentLocale);\n  if (renderContactName) {\n    const { fallBackName: fallBackNameFromThirdParty, fallBackNumber } = pickFallBackInfo(\n      activeSession,\n      renderContactName({ sessionId }),\n      locale.currentLocale\n    );\n    phoneNumber = fallBackNumber;\n    fallBackName = fallBackNameFromThirdParty;\n  }\n  return {\n    currentLocale: locale.currentLocale,\n    activeSession,\n    sessionId,\n    areaCode: regionSettings.areaCode,\n    countryCode: regionSettings.countryCode,\n    otherDeviceCalls: callMonitor.otherDeviceCalls,\n    nameMatches,\n    phoneNumber,\n    fallBackName,\n    brand: brand.fullName,\n    activeCallControl,\n  };\n}\n\nfunction mapToFunctions(_, {\n  phone: {\n    routerInteraction,\n    activeCallControl\n  },\n}) {\n  return {\n    onBackButtonClick() {\n      routerInteraction.goBack();\n    },\n    setActiveSessionId(sessionId) {\n      activeCallControl.setActiveSessionId(sessionId);\n    },\n    onTransfer(sessionId) {\n      routerInteraction.push(`/transfer/${sessionId}/active`);\n    }\n  };\n}\n\nclass ActiveCallControlPanel extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      selectedMatcherIndex: 0,\n    };\n\n    this.onMute = () => this.props.activeCallControl.mute(this.props.sessionId);\n    this.onUnmute = () => this.props.activeCallControl.unmute(this.props.sessionId);\n    this.onHold = () => this.props.activeCallControl.hold(this.props.sessionId);\n    this.onUnhold = () => this.props.activeCallControl.unHold(this.props.sessionId);\n    this.onHangup = () => this.props.activeCallControl.hangUp(this.props.sessionId);\n\n    this.formatPhone = phoneNumber => formatNumber({\n      phoneNumber,\n      areaCode: this.props.areaCode,\n      countryCode: this.props.countryCode,\n    });\n\n    this.onSelectMatcherName = (option) => {\n      const nameMatches = this.props.nameMatches || [];\n      let selectedMatcherIndex = nameMatches.findIndex(\n        match => match.id === option.id\n      );\n      if (selectedMatcherIndex < 0) {\n        selectedMatcherIndex = 0;\n      }\n      this.setState({\n        selectedMatcherIndex,\n      });\n    };\n  }\n\n  componentDidMount() {\n    this.loadActCall();\n  }\n  loadActCall() {\n    this.props.setActiveSessionId(this.props.sessionId);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (!nextProps.activeSession) {\n      this.props.onBackButtonClick();\n    }\n  }\n\n  render() {\n    if (!this.props.activeSession) {\n      // or using skeleton screen here\n      return null;\n    }\n    const { muteCtrl, transferCtrl, holdCtrl } = ACTIONS_CTRL_MAP;\n\n    return (\n      <CallCtrlPanel\n        sessionId={this.props.sessionId}\n        currentLocale={this.props.currentLocale}\n        fallBackName={this.props.fallBackName}\n        phoneNumber={this.props.phoneNumber}\n        onMute={this.onMute}\n        onUnmute={this.onUnmute}\n        onHold={this.onHold}\n        onUnhold={this.onUnhold}\n        onHangup={this.onHangup}\n        onTransfer={this.props.onTransfer}\n        showBackButton\n        backButtonLabel={i18n.getString('allCalls', this.props.currentLocale)}\n        onBackButtonClick={this.props.onBackButtonClick}\n        formatPhone={this.formatPhone}\n        areaCode={this.props.areaCode}\n        countryCode={this.props.countryCode}\n        selectedMatcherIndex={this.state.selectedMatcherIndex}\n        layout={callCtrlLayouts.normalCtrl}\n        startTime={this.props.activeSession.startTime}\n        actions={[muteCtrl, transferCtrl, holdCtrl]}\n        isOnMute={this.props.activeSession.isOnMute}\n        isOnHold={this.props.activeSession.isOnHold}\n        nameMatches={this.props.nameMatches}\n        onSelectMatcherName={this.onSelectMatcherName}\n        brand={this.props.brand}\n        showContactDisplayPlaceholder={this.props.showContactDisplayPlaceholder}\n      />\n    );\n  }\n}\n\nActiveCallControlPanel.propTypes = {\n  setActiveSessionId: PropTypes.func,\n  currentLocale: PropTypes.string,\n  sessionId: PropTypes.string,\n  areaCode: PropTypes.string.isRequired,\n  countryCode: PropTypes.string.isRequired,\n  activeSession: PropTypes.object,\n  onBackButtonClick: PropTypes.func.isRequired,\n  activeCallControl: PropTypes.object,\n  nameMatches: PropTypes.array,\n  fallBackName: PropTypes.string,\n  phoneNumber: PropTypes.string,\n  showContactDisplayPlaceholder: PropTypes.bool,\n  brand: PropTypes.string.isRequired,\n  onTransfer: PropTypes.func.isRequired,\n};\n\nActiveCallControlPanel.defaultProps = {\n  setActiveSessionId() {},\n  currentLocale: 'en-US',\n  activeCallControl: {},\n  activeSession: null,\n  sessionId: null,\n  nameMatches: [],\n  fallBackName: '',\n  phoneNumber: '',\n  showContactDisplayPlaceholder: false,\n};\n\nexport default withPhone(connect(mapToProps, mapToFunctions)(ActiveCallControlPanel));\n"],"file":"index.js"}