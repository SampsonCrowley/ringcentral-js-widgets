{"version":3,"sources":["modules/Webphone/webphoneHelper.js"],"names":["environment","window","global","isChrome","navigator","browserUa","userAgent","toLowerCase","match","isFirefox","indexOf","isWebSocketSupport","WebSocket","isWebRTCSupport","MediaStream","RTCPeerConnection","mediaDevices","getUserMedia","isBrowserSupport","extractHeadersData","session","headers","raw","data","split","map","sub","reduce","accum","key","value","Object","keys","length","__rc_partyData","__rc_callId","normalizeSession","id","callId","direction","__rc_direction","callStatus","__rc_callStatus","to","request","uri","user","toUserName","displayName","from","fromNumber","__rc_fromNumber","fromUserName","startTime","Date","getTime","creationTime","__rc_creationTime","isOnHold","onLocalHold","isOnMute","__rc_isOnMute","isOnFlip","__rc_isOnFlip","isOnTransfer","__rc_isOnTransfer","isToVoicemail","__rc_isToVoicemail","isForwarded","__rc_isForwarded","isReplied","__rc_isReplied","recordStatus","__rc_recordStatus","idle","contactMatch","__rc_contactMatch","minimized","__rc_minimized","partyData","lastActiveTime","__rc_lastActiveTime","cached","removed","isRing","callDirections","inbound","sessionStatus","connecting","sortByCreationTimeDesc","l","r","sortByLastActiveTimeDesc","isConferenceSession","isRecording","pending","recording"],"mappings":"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","sourcesContent":["import recordStatus from './recordStatus';\nimport sessionStatus from './sessionStatus';\nimport { camelize } from '../../lib/di/utils/utils';\nimport callDirections from '../../enums/callDirections';\n\nlet environment;\nif (typeof window !== 'undefined') {\n  environment = window;\n}\nif (typeof global !== 'undefined') {\n  environment = global.window || global;\n}\n\nexport function isChrome() {\n  if (!environment.navigator) {\n    return false;\n  }\n  const browserUa = environment.navigator.userAgent.toLowerCase()\n  return !!(browserUa.match(/chrom(e|ium)/));\n}\n\nexport function isFirefox() {\n  if (!environment.navigator) {\n    return false;\n  }\n  const browserUa = environment.navigator.userAgent.toLowerCase()\n  return browserUa.indexOf('firefox') > -1 && !isChrome();\n}\n\nexport function isWebSocketSupport() {\n  return !!(environment && environment.WebSocket);\n}\n\nexport function isWebRTCSupport() {\n  if (!environment.navigator) {\n    return false;\n  }\n  return !!(\n    environment.MediaStream &&\n    environment.RTCPeerConnection &&\n    environment.navigator.mediaDevices.getUserMedia\n  );\n}\n\nexport function isBrowserSupport() {\n  return isWebSocketSupport() && isWebRTCSupport();\n}\n\nexport function extractHeadersData(session, headers) {\n  if (\n    headers\n    && headers['P-Rc-Api-Ids']\n    && headers['P-Rc-Api-Ids'][0]\n    && headers['P-Rc-Api-Ids'][0].raw\n  ) {\n    /**\n     * interface PartyData {\n     *  \"partyId\": String,\n     *  \"sessionId\": String\n     * }\n     *\n     * INFO: partyId is ID of the participant in current Session. Mostly it represents User on the call,\n     * it could be active participant (talking right now) or already disconnected User,\n     * e.g. who made a transfer to another person.\n     * To identify the User who owns the party you need to find owner.extensionId within party.\n     */\n    const data = headers['P-Rc-Api-Ids'][0].raw\n      .split(';')\n      .map(sub => sub.split('='))\n      .reduce((accum, [key, value]) => {\n        accum[camelize(key)] = value;\n        return accum;\n      }, {});\n\n    if (Object.keys(data).length) {\n      session.__rc_partyData = data;\n    }\n  }\n\n  if (\n    headers\n    && headers['Call-ID']\n    && headers['Call-ID'][0]\n    && headers['Call-ID'][0].raw\n  ) {\n    session.__rc_callId = headers['Call-ID'][0].raw;\n  }\n}\n\nexport function normalizeSession(session) {\n  return {\n    id: session.id,\n    callId: session.__rc_callId,\n    direction: session.__rc_direction,\n    callStatus: session.__rc_callStatus,\n    to: session.request.to.uri.user,\n    toUserName: session.request.to.displayName,\n    from: session.request.from.uri.user,\n    fromNumber: session.__rc_fromNumber,\n    fromUserName: session.request.from.displayName,\n    startTime: session.startTime && (new Date(session.startTime)).getTime(),\n    creationTime: session.__rc_creationTime,\n    isOnHold: !!session.onLocalHold(),\n    isOnMute: !!session.__rc_isOnMute,\n    isOnFlip: !!session.__rc_isOnFlip,\n    isOnTransfer: !!session.__rc_isOnTransfer,\n    isToVoicemail: !!session.__rc_isToVoicemail,\n    isForwarded: !!session.__rc_isForwarded,\n    isReplied: !!session.__rc_isReplied,\n    recordStatus: session.__rc_recordStatus || recordStatus.idle,\n    contactMatch: session.__rc_contactMatch,\n    minimized: !!session.__rc_minimized,\n    partyData: session.__rc_partyData || null,\n    lastActiveTime: session.__rc_lastActiveTime,\n    cached: false,\n    removed: false,\n  };\n}\n\nexport function isRing(session) {\n  return !!(\n    session &&\n    session.direction === callDirections.inbound &&\n    session.callStatus === sessionStatus.connecting\n  );\n}\n\nexport function isOnHold(session) {\n  return !!(session && session.isOnHold);\n}\n\nexport function sortByCreationTimeDesc(l, r) {\n  return r.startTime - l.startTime;\n}\n\nexport function sortByLastActiveTimeDesc(l, r) {\n  if (!l || !r) {\n    return 0;\n  }\n  if (r.lastActiveTime !== l.lastActiveTime) {\n    return r.lastActiveTime - l.lastActiveTime;\n  }\n  return sortByCreationTimeDesc(l, r);\n}\n\n/**\n * HACK: this function is not very reliable, only use it before the merging complete.\n */\nexport function isConferenceSession(session) {\n  return session && session.to &&\n    session.to.indexOf('conf_') === 0;\n}\n\nexport function isRecording(session) {\n  return !!(\n    session &&\n    (\n      session.recordStatus === recordStatus.pending ||\n      session.recordStatus === recordStatus.recording\n    )\n  );\n}\n"],"file":"webphoneHelper.js"}