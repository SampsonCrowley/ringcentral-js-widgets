{"version":3,"sources":["modules/Conversations/index.js"],"names":["getEarliestTime","messages","newTime","Date","now","forEach","message","creationTime","getTime","getUniqueNumbers","conversations","output","numberMap","addIfNotExist","number","push","from","fromNumber","phoneNumber","extensionNumber","to","length","toNumber","toPhoneNumber","DEFAULT_PER_PAGE","DEFAULT_DAY_SPAN","Conversations","deps","dep","optional","alert","auth","client","messageSender","extensionInfo","messageStore","rolesAndPermissions","contactMatcher","conversationLogger","perPage","daySpan","enableLoadOldMessages","showMMSAttachment","options","actionTypes","_auth","ensureExist","_alert","_client","_messageSender","_extensionInfo","_messageStore","_rolesAndPermissions","_contactMatcher","_conversationLogger","_reducer","_promise","_lastProcessedNumbers","_perPage","_daySpan","_olderDataExsited","_olderMessagesExsited","_enableLoadOldMessages","_showMMSAttachment","_lastConversaionList","addQuerySource","getQueriesFn","uniqueNumbers","readyCheckFn","ready","store","subscribe","_onStateChange","_shouldInit","_init","_shouldReset","_reset","allUniqueNumbers","_lastProcessedPage","currentPage","_lastTypeFilter","typeFilter","_lastSearchString","effectiveSearchString","triggerMatch","allConversations","oldConversations","dispatch","type","cleanOldConversatioans","loggedIn","pending","init","initSuccess","_hasPermission","fetchOldConversations","resetSuccess","input","updateSearchInput","updateTypeFilter","pagingConversations","loadNextPage","loadingOldConversations","fetchOldConverstaions","dateFrom","setDate","getDate","dateTo","earliestTime","params","distinctConversations","toISOString","messageTypes","text","messageType","sms","pager","all","account","extension","list","records","fetchOldConverstaionsSuccess","fetchOldConverstaionsError","filteredConversations","increaseCurrentPage","resetCurrentPage","conversationId","currentConversationId","updateCurrentConversationId","loadingOldMessages","fetchOldMessages","currentConversation","fetchOldMessagesSuccess","fetchOldMessagesError","ttlConfig","messageSenderMessages","noAreaCode","ttl","warning","_alertWarning","textTooLong","updateMessageText","reply","send","_getFromNumber","toNumbers","_getToNumbers","replyOnMessageId","_getReplyOnMessageId","responses","pushMessage","replySuccess","removeMessageText","_onReplyError","messageList","lastMessage","id","senderNumber","recipients","map","recipient","conversationStore","deleteConversationMessages","conversation","find","c","deleteCoversation","deleteMessageApi","deleteConversation","console","error","entitys","addEntity","entity","removeEntity","correspondentMatch","response","direction","messageDirection","inbound","correspondentMatches","dataMapping","correspondentEntity","filter","some","match","innerMatch","rawId","logConversation","state","status","searchInput","fetchConversationsStatus","fetchMessagesStatus","oldMessages","fetching","conversationStatus","pushing","hasReadMessagesPermission","RcModule","proxify","getter","newConversations","conversationMap","pushConversation","messageIsTextMessage","voiceMail","messageIsVoicemail","fax","messageIsFax","readTextPermissions","voicemailPermissions","readFaxPermissions","typeFilteredConversations","loggingMap","accessToken","contactMapping","conversationLogMapping","self","correspondents","selfNumber","selfMatches","reduce","matches","contact","concat","conversationLogId","getConversationLogId","isLogging","conversationMatches","voicemailAttachment","faxAttachment","unreadCounts","mmsAttachment","subject","lastMatchedCorrespondentEntity","getLastMatchedCorrespondentEntity","formatedConversations","searchResults","cleanRegex","searchString","toLowerCase","searchNumber","replace","cleanedNumber","indexOf","matchOrder","name","matchedMessage","item","sort","sortSearchResults","pageNumber","lastIndex","slice","allMessages","m","reverse","myExtensionNumber","myNumber","messageTexts","res","msg"],"mappings":"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","file":"index.js","sourcesContent":["import { createSelector } from 'reselect';\nimport messageDirection from '../../enums/messageDirection';\nimport RcModule from '../../lib/RcModule';\nimport { Module } from '../../lib/di';\nimport getter from '../../lib/getter';\nimport ensureExist from '../../lib/ensureExist';\nimport proxify from '../../lib/proxy/proxify';\nimport messageTypes from '../../enums/messageTypes';\nimport cleanNumber from '../../lib/cleanNumber';\nimport isBlank from '../../lib/isBlank';\nimport messageSenderMessages from '../MessageSender/messageSenderMessages';\n\nimport {\n  getNumbersFromMessage,\n  sortSearchResults,\n  messageIsTextMessage,\n  messageIsVoicemail,\n  getVoicemailAttachment,\n  getFaxAttachment,\n  getMMSAttachment,\n  messageIsFax,\n  getMyNumberFromMessage,\n  getRecipientNumbersFromMessage,\n  messageIsUnread,\n} from '../../lib/messageHelper';\n\nimport actionTypes from './actionTypes';\nimport getReducer from './getReducer';\nimport status from './status';\n\nfunction getEarliestTime(messages) {\n  let newTime = Date.now();\n  messages.forEach((message) => {\n    const creationTime = (new Date(message.creationTime)).getTime();\n    if (creationTime < newTime) {\n      newTime = creationTime;\n    }\n  });\n  return newTime;\n}\n\nfunction getUniqueNumbers(conversations) {\n  const output = [];\n  const numberMap = {};\n  function addIfNotExist(number) {\n    if (number && !numberMap[number]) {\n      output.push(number);\n      numberMap[number] = true;\n    }\n  }\n  conversations.forEach((message) => {\n    if (message.from) {\n      const fromNumber = message.from.phoneNumber || message.from.extensionNumber;\n      addIfNotExist(fromNumber);\n    }\n    if (message.to && message.to.length > 0) {\n      message.to.forEach((toNumber) => {\n        if (!toNumber) {\n          return;\n        }\n        const toPhoneNumber = toNumber.phoneNumber || toNumber.extensionNumber;\n        addIfNotExist(toPhoneNumber);\n      });\n    }\n  });\n  return output;\n}\n\nconst DEFAULT_PER_PAGE = 20;\nconst DEFAULT_DAY_SPAN = 90;\n\n@Module({\n  deps: [\n    'Alert',\n    'Auth',\n    'Client',\n    'MessageSender',\n    'ExtensionInfo',\n    'MessageStore',\n    'RolesAndPermissions',\n    { dep: 'ContactMatcher', optional: true },\n    { dep: 'ConversationLogger', optional: true },\n    { dep: 'ConversationsOptions', optional: true }\n  ],\n})\nexport default class Conversations extends RcModule {\n  constructor({\n    alert,\n    auth,\n    client,\n    messageSender,\n    extensionInfo,\n    messageStore,\n    rolesAndPermissions,\n    contactMatcher,\n    conversationLogger,\n    perPage = DEFAULT_PER_PAGE,\n    daySpan = DEFAULT_DAY_SPAN,\n    enableLoadOldMessages = false, // disable old message by default\n    showMMSAttachment = false,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = this:: ensureExist(auth, 'auth');\n    this._alert = this:: ensureExist(alert, 'alert');\n    this._client = this:: ensureExist(client, 'client');\n    this._messageSender = this:: ensureExist(messageSender, 'messageSender');\n    this._extensionInfo = this:: ensureExist(extensionInfo, 'extensionInfo');\n    this._messageStore = this:: ensureExist(messageStore, 'messageStore');\n    this._rolesAndPermissions =\n      this:: ensureExist(rolesAndPermissions, 'rolesAndPermissions');\n    this._contactMatcher = contactMatcher;\n    this._conversationLogger = conversationLogger;\n\n    this._reducer = getReducer(this.actionTypes);\n\n    this._promise = null;\n    this._lastProcessedNumbers = null;\n    this._perPage = perPage;\n    this._daySpan = daySpan;\n    this._olderDataExsited = true;\n    this._olderMessagesExsited = true;\n    this._enableLoadOldMessages = enableLoadOldMessages;\n    this._showMMSAttachment = showMMSAttachment;\n    this._lastConversaionList = [];\n\n    if (this._contactMatcher) {\n      this._contactMatcher.addQuerySource({\n        getQueriesFn: () => this.uniqueNumbers,\n        readyCheckFn: () => (\n          this._messageStore.ready\n        ),\n      });\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this._init();\n    } else if (this._shouldReset()) {\n      this._reset();\n    } else if (\n      this._lastProcessedNumbers !== this.allUniqueNumbers ||\n      this._lastProcessedPage !== this.currentPage ||\n      this._lastTypeFilter !== this.typeFilter ||\n      this._lastSearchString !== this.effectiveSearchString\n    ) {\n      this._lastProcessedNumbers = this.allUniqueNumbers;\n      this._lastProcessedPage = this.currentPage;\n      this._lastTypeFilter = this.typeFilter;\n      this._lastSearchString = this.effectiveSearchString;\n      if (this._contactMatcher) {\n        this._contactMatcher.triggerMatch();\n      }\n    } else if (this._lastConversaionList.length > this._messageStore.allConversations.length) {\n      this._lastConversaionList = this._messageStore.allConversations;\n      if (this.oldConversations.length) {\n        this.store.dispatch({\n          type: this.actionTypes.cleanOldConversatioans\n        });\n      }\n    }\n  }\n\n  _shouldInit() {\n    return (\n      this._auth.loggedIn &&\n      this._extensionInfo.ready &&\n      this._messageSender.ready &&\n      this._messageStore.ready &&\n      this._rolesAndPermissions.ready &&\n      (!this._contactMatcher || this._contactMatcher.ready) &&\n      (!this._conversationLogger || this._conversationLogger.ready) &&\n      this.pending\n    );\n  }\n\n  _shouldReset() {\n    return (\n      (\n        !this._auth.loggedIn ||\n        !this._extensionInfo.ready ||\n        !this._messageSender.ready ||\n        !this._rolesAndPermissions ||\n        !this._messageStore.ready ||\n        (this._contactMatcher && !this._contactMatcher.ready) ||\n        (this._conversationLogger && !this._conversationLogger.ready)\n      ) &&\n      this.ready\n    );\n  }\n\n  _init() {\n    this.store.dispatch({\n      type: this.actionTypes.init,\n    });\n    if (this._contactMatcher) {\n      this._contactMatcher.triggerMatch();\n    }\n    this.store.dispatch({\n      type: this.actionTypes.initSuccess,\n    });\n    this._lastConversaionList = this._messageStore.allConversations;\n    if (\n      this.allConversations.length <= this._perPage &&\n      this._enableLoadOldMessages &&\n      this._hasPermission\n    ) {\n      this.fetchOldConversations();\n    }\n  }\n\n  _reset() {\n    this._lastProcessedNumbers = null;\n    this._olderDataExsited = true;\n    this._olderMessagesExsited = true;\n    this.store.dispatch({\n      type: this.actionTypes.resetSuccess,\n    });\n  }\n\n  @proxify\n  async updateSearchInput(input) {\n    this.store.dispatch({\n      type: this.actionTypes.updateSearchInput,\n      input,\n    });\n  }\n\n  @proxify\n  async updateTypeFilter(type) {\n    if (this.typeFilter === type) {\n      return;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.updateTypeFilter,\n      typeFilter: type,\n    });\n    this._olderDataExsited = true;\n    this._olderMessagesExsited = true;\n    if (this.pagingConversations.length <= this._perPage) {\n      this.loadNextPage();\n    }\n  }\n\n  @proxify\n  async fetchOldConversations() {\n    if (!this._olderDataExsited) {\n      return;\n    }\n    if (this.loadingOldConversations) {\n      return;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.fetchOldConverstaions,\n    });\n    let dateFrom = new Date();\n    dateFrom.setDate(dateFrom.getDate() - this._daySpan);\n    const dateTo = new Date(this.earliestTime);\n    if (dateTo.getTime() < dateFrom.getTime()) {\n      dateFrom = new Date(dateTo.getTime() - 1000 * 3600 * 24);\n    }\n    const typeFilter = this.typeFilter;\n    const currentPage = this.currentPage;\n    const params = {\n      distinctConversations: true,\n      perPage: this._perPage,\n      dateFrom: dateFrom.toISOString(),\n      dateTo: dateTo.toISOString(),\n    };\n    if (typeFilter === messageTypes.text) {\n      params.messageType = [messageTypes.sms, messageTypes.pager];\n    } else if (typeFilter && typeFilter !== '' && typeFilter !== messageTypes.all) {\n      params.messageType = typeFilter;\n    }\n    try {\n      const { records } = await this._client\n        .account()\n        .extension()\n        .messageStore()\n        .list(params);\n      this._olderDataExsited = records.length === this._perPage;\n      if (typeFilter === this.typeFilter && currentPage === this.currentPage) {\n        this.store.dispatch({\n          type: this.actionTypes.fetchOldConverstaionsSuccess,\n          records,\n        });\n      }\n    } catch (e) {\n      if (typeFilter === this.typeFilter && currentPage === this.currentPage) {\n        this.store.dispatch({\n          type: this.actionTypes.fetchOldConverstaionsError\n        });\n      }\n    }\n  }\n\n  @proxify\n  async loadNextPage() {\n    const currentPage = this.currentPage;\n    if ((currentPage + 1) * this._perPage <= this.filteredConversations.length) {\n      this.store.dispatch({\n        type: this.actionTypes.increaseCurrentPage,\n      });\n      return;\n    }\n    if (this.effectiveSearchString !== '') {\n      return;\n    }\n    if (!this._enableLoadOldMessages || !this._hasPermission) {\n      return;\n    }\n    await this.fetchOldConversations();\n  }\n\n  @proxify\n  async resetCurrentPage() {\n    this.store.dispatch({\n      type: this.actionTypes.resetCurrentPage,\n    });\n  }\n\n  @proxify\n  async loadConversation(conversationId) {\n    if (conversationId === this.currentConversationId) {\n      return;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentConversationId,\n      conversationId,\n    });\n  }\n\n  @proxify\n  async unloadConversation() {\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentConversationId,\n      conversationId: null,\n    });\n    this._olderMessagesExsited = true;\n  }\n\n  @proxify\n  async fetchOldMessages(perPage = this._perPage) {\n    if (!this._enableLoadOldMessages) {\n      return;\n    }\n    if (!this._hasPermission) {\n      return;\n    }\n    if (!this._olderMessagesExsited) {\n      return;\n    }\n    if (this.loadingOldMessages) {\n      return;\n    }\n    if (!this.currentConversationId) {\n      return;\n    }\n    this.store.dispatch({\n      type: this.actionTypes.fetchOldMessages,\n    });\n    const conversationId = this.currentConversationId;\n    const dateFrom = new Date();\n    dateFrom.setDate(dateFrom.getDate() - this._daySpan);\n    const earliestTime = getEarliestTime(this.currentConversation.messages);\n    const dateTo = new Date(earliestTime);\n    if (dateTo.getTime() < dateFrom.getTime()) {\n      dateFrom.setDate(dateFrom.getDate() - 1);\n    }\n    const params = {\n      conversationId,\n      perPage,\n      dateFrom: dateFrom.toISOString(),\n      dateTo: dateTo.toISOString(),\n    };\n    try {\n      const { records } = await this._client\n        .account()\n        .extension()\n        .messageStore()\n        .list(params);\n      this._olderMessagesExsited = records.length === perPage;\n      if (conversationId === this.currentConversationId) {\n        this.store.dispatch({\n          type: this.actionTypes.fetchOldMessagesSuccess,\n          records,\n        });\n      }\n    } catch (e) {\n      if (conversationId === this.currentConversationId) {\n        this.store.dispatch({\n          type: this.actionTypes.fetchOldMessagesError\n        });\n      }\n    }\n  }\n\n  _alertWarning(message) {\n    if (message) {\n      const ttlConfig =\n        message !== messageSenderMessages.noAreaCode ? { ttl: 0 } : null;\n      this._alert.warning({\n        message,\n        ...ttlConfig,\n      });\n      return true;\n    }\n    return false;\n  }\n\n  @proxify\n  async updateMessageText(text) {\n    if (text.length > 1000) {\n      return this._alertWarning(messageSenderMessages.textTooLong);\n    }\n    return this.store.dispatch({\n      type: this.actionTypes.updateMessageText,\n      text,\n      conversationId: this.currentConversationId,\n    });\n  }\n\n  @proxify\n  async replyToReceivers(text) {\n    this.store.dispatch({\n      type: this.actionTypes.reply,\n    });\n    try {\n      const responses = await this._messageSender.send({\n        fromNumber: this._getFromNumber(),\n        toNumbers: this._getToNumbers(),\n        text,\n        replyOnMessageId: this._getReplyOnMessageId(),\n      });\n      if (responses && responses[0]) {\n        this._messageStore.pushMessage(responses[0]);\n        this.store.dispatch({\n          type: this.actionTypes.replySuccess,\n        });\n        this.store.dispatch({\n          type: this.actionTypes.removeMessageText,\n          conversationId: this.currentConversationId,\n        });\n        return responses[0];\n      }\n      this._onReplyError();\n      return null;\n    } catch (error) {\n      this._onReplyError();\n      throw error;\n    }\n  }\n\n  _getReplyOnMessageId() {\n    const messageList = this.currentConversation.messages;\n    const lastMessage =\n      messageList &&\n      messageList.length > 0 &&\n      messageList[messageList.length - 1];\n    if (lastMessage && lastMessage.id) {\n      return lastMessage.id;\n    }\n    return null;\n  }\n\n  _getFromNumber() {\n    const senderNumber = this.currentConversation.senderNumber;\n    if (!senderNumber) {\n      return null;\n    }\n    return senderNumber.extensionNumber || senderNumber.phoneNumber;\n  }\n\n  _getToNumbers() {\n    const recipients = this.currentConversation.recipients;\n    return recipients.map(\n      recipient => recipient.extensionNumber || recipient.phoneNumber,\n    );\n  }\n\n  @proxify\n  async deleteCoversation(conversationId) {\n    if (!conversationId) {\n      return;\n    }\n    if (this._messageStore.conversationStore[conversationId]) {\n      await this._messageStore.deleteConversationMessages(conversationId);\n      return;\n    }\n    const conversation = this.allConversations.find(\n      c => c.conversationId === conversationId\n    );\n    if (!conversation) {\n      return;\n    }\n    if (messageIsTextMessage(conversation)) {\n      await this._messageStore.deleteCoversation(conversationId);\n      return;\n    }\n    try {\n      await this._messageStore.deleteMessageApi(conversationId);\n      this.store.dispatch({\n        type: this.actionTypes.deleteConversation,\n        conversationId,\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  @getter\n  allConversations = createSelector(\n    () => this._messageStore.allConversations,\n    () => this.oldConversations,\n    (conversations, oldConversations) => {\n      if (oldConversations.length === 0) {\n        return conversations;\n      }\n      const newConversations = [];\n      const conversationMap = {};\n      const pushConversation = (c) => {\n        if (conversationMap[c.id]) {\n          return;\n        }\n        newConversations.push(c);\n        conversationMap[c.id] = 1;\n      };\n      conversations.forEach(pushConversation);\n      oldConversations.forEach(pushConversation);\n      return newConversations;\n    }\n  )\n\n  @getter\n  uniqueNumbers = createSelector(\n    () => this.pagingConversations,\n    getUniqueNumbers\n  )\n\n  @getter\n  allUniqueNumbers = createSelector(\n    () => this.allConversations,\n    getUniqueNumbers,\n  )\n\n  @getter\n  effectiveSearchString = createSelector(\n    () => this.state.searchInput,\n    (input) => {\n      if (input.length >= 3) return input;\n      return '';\n    }\n  )\n\n  @getter\n  typeFilteredConversations = createSelector(\n    () => this.allConversations,\n    () => this.typeFilter,\n    (allConversations, typeFilter) => {\n      switch (typeFilter) {\n        case messageTypes.text:\n          return allConversations.filter(messageIsTextMessage);\n        case messageTypes.voiceMail:\n          return allConversations.filter(messageIsVoicemail);\n        case messageTypes.fax:\n          return allConversations.filter(messageIsFax);\n        default:\n          return allConversations.filter(\n            conversation => (\n              (\n                this._rolesAndPermissions.readTextPermissions ||\n                !messageIsTextMessage(conversation)\n              ) &&\n              (\n                this._rolesAndPermissions.voicemailPermissions ||\n                !messageIsVoicemail(conversation)\n              ) &&\n              (\n                this._rolesAndPermissions.readFaxPermissions ||\n                !messageIsFax(conversation)\n              )\n            )\n          );\n      }\n    }\n  );\n\n  @getter\n  formatedConversations = createSelector(\n    () => this.typeFilteredConversations,\n    () => this._extensionInfo.extensionNumber,\n    () => this._contactMatcher && this._contactMatcher.dataMapping,\n    () => this._conversationLogger && this._conversationLogger.loggingMap,\n    () => this._conversationLogger && this._conversationLogger.dataMapping,\n    () => this._auth.accessToken,\n    (\n      conversations,\n      extensionNumber,\n      contactMapping = {},\n      loggingMap = {},\n      conversationLogMapping = {},\n      accessToken,\n    ) => (\n      conversations.map((message) => {\n        const {\n          self,\n          correspondents,\n        } = getNumbersFromMessage({ extensionNumber, message });\n        const selfNumber = self && (self.phoneNumber || self.extensionNumber);\n        const selfMatches = (selfNumber && contactMapping[selfNumber]) || [];\n        const correspondentMatches = correspondents.reduce((matches, contact) => {\n          const number = contact && (contact.phoneNumber || contact.extensionNumber);\n          return number && contactMapping[number] && contactMapping[number].length ?\n            matches.concat(contactMapping[number]) :\n            matches;\n        }, []);\n        const conversationLogId = this._conversationLogger ?\n          this._conversationLogger.getConversationLogId(message) :\n          null;\n        const isLogging = !!(conversationLogId && loggingMap[conversationLogId]);\n        const conversationMatches = conversationLogMapping[conversationLogId] || [];\n        let voicemailAttachment = null;\n        if (messageIsVoicemail(message)) {\n          voicemailAttachment = getVoicemailAttachment(message, accessToken);\n        }\n        let faxAttachment = null;\n        if (messageIsFax(message)) {\n          faxAttachment = getFaxAttachment(message, accessToken);\n        }\n        let unreadCounts = message.unreadCounts;\n        if (typeof unreadCounts === 'undefined') {\n          unreadCounts = messageIsUnread(message) ? 1 : 0;\n        }\n        let mmsAttachment = null;\n        if (messageIsTextMessage(message) && isBlank(message.subject) && this._showMMSAttachment) {\n          mmsAttachment = getMMSAttachment(message);\n        }\n        return {\n          ...message,\n          unreadCounts,\n          self,\n          selfMatches,\n          correspondents,\n          correspondentMatches,\n          conversationLogId,\n          isLogging,\n          conversationMatches,\n          voicemailAttachment,\n          faxAttachment,\n          mmsAttachment,\n          lastMatchedCorrespondentEntity: (\n            this._conversationLogger &&\n              this._conversationLogger.getLastMatchedCorrespondentEntity(message)\n          ) || null,\n        };\n      })\n    ),\n  )\n\n  @getter\n  filteredConversations = createSelector(\n    () => this.formatedConversations,\n    () => this.effectiveSearchString,\n    (conversations, effectiveSearchString) => {\n      if (effectiveSearchString === '') {\n        return conversations;\n      }\n      const searchResults = [];\n      const cleanRegex = /[^\\d*+#\\s]/g;\n      const searchString = effectiveSearchString.toLowerCase();\n      const searchNumber = effectiveSearchString.replace(cleanRegex, '');\n      conversations.forEach((message) => {\n        if (searchNumber === effectiveSearchString) {\n          const cleanedNumber = cleanNumber(effectiveSearchString);\n          if (\n            message.correspondents.find(\n              contact => (\n                cleanNumber(contact.phoneNumber || contact.extensionNumber || '')\n                  .indexOf(cleanedNumber) > -1\n              )\n            )\n          ) {\n            // match by phoneNumber or extensionNumber\n            searchResults.push({\n              ...message,\n              matchOrder: 0,\n            });\n            return;\n          }\n        }\n        if (message.correspondentMatches.length) {\n          if (\n            message.correspondentMatches.find(entity => (\n              (entity.name || '').toLowerCase().indexOf(searchString) > -1\n            ))\n          ) {\n            // match by entity's name\n            searchResults.push({\n              ...message,\n              matchOrder: 0,\n            });\n            return;\n          }\n        } else if (message.correspondents.find(contact => (\n          (contact.name || '').toLowerCase().indexOf(searchString) > -1\n        ))) {\n          searchResults.push({\n            ...message,\n            matchOrder: 0,\n          });\n          return;\n        }\n\n        // try match messages of the same conversation\n        if ((message.subject || '').toLowerCase().indexOf(searchString) > -1) {\n          searchResults.push({\n            ...message,\n            matchOrder: 1,\n          });\n          return;\n        }\n        const messageList = this._messageStore.conversationStore[message.conversationId] || [];\n        const matchedMessage = messageList.find(item => (\n          (item.subject || '').toLowerCase().indexOf(searchString) > -1\n        ));\n        if (matchedMessage) {\n          searchResults.push({\n            ...message,\n            matchedMessage,\n            matchOrder: 1,\n          });\n        }\n      });\n      return searchResults.sort(sortSearchResults);\n    },\n  )\n\n  @getter\n  pagingConversations = createSelector(\n    () => this.filteredConversations,\n    () => this.currentPage,\n    (conversations, pageNumber) => {\n      const lastIndex = (pageNumber * this._perPage);\n      return conversations.slice(0, lastIndex);\n    }\n  )\n\n  @getter\n  earliestTime = createSelector(\n    () => this.typeFilteredConversations,\n    getEarliestTime,\n  )\n\n  @getter\n  currentConversation = createSelector(\n    () => this.currentConversationId,\n    () => this._extensionInfo.extensionNumber,\n    () => this._contactMatcher && this._contactMatcher.dataMapping,\n    () => this.oldMessages,\n    () => this._messageStore.conversationStore,\n    () => this.allConversations,\n    () => this._auth.accessToken,\n    () => this._conversationLogger && this._conversationLogger.dataMapping,\n    (\n      conversationId,\n      extensionNumber,\n      contactMapping,\n      oldMessages,\n      conversationStore,\n      conversations,\n      accessToken,\n      conversationLogMapping = {},\n    ) => {\n      const conversation = conversations.find(\n        c => c.conversationId === conversationId\n      );\n      const messages = [].concat(conversationStore[conversationId] || []);\n      const currentConversation = {\n        ...conversation\n      };\n      const allMessages = (messages.concat(oldMessages)).map((m) => {\n        if (!this._showMMSAttachment) {\n          return m;\n        }\n        const mmsAttachment = getMMSAttachment(m, accessToken);\n        return {\n          ...m,\n          mmsAttachment,\n        };\n      });\n      const {\n        correspondents = [],\n      } = getNumbersFromMessage({ extensionNumber, message: conversation });\n      const correspondentMatches = correspondents.reduce((matches, contact) => {\n        const number = contact && (contact.phoneNumber || contact.extensionNumber);\n        return number && contactMapping[number] && contactMapping[number].length ?\n          matches.concat(contactMapping[number]) :\n          matches;\n      }, []);\n      const conversationLogId = this._conversationLogger ?\n        this._conversationLogger.getConversationLogId(conversation) :\n        null;\n      const conversationMatches = conversationLogMapping[conversationLogId] || [];\n      currentConversation.correspondents = correspondents;\n      currentConversation.correspondentMatches = correspondentMatches;\n      currentConversation.conversationMatches = conversationMatches;\n      currentConversation.messages = allMessages.reverse();\n      currentConversation.senderNumber = getMyNumberFromMessage({\n        message: conversation,\n        myExtensionNumber: this._extensionInfo.extensionNumber,\n      });\n      currentConversation.recipients = getRecipientNumbersFromMessage({\n        message: conversation,\n        myNumber: currentConversation.senderNumber,\n      });\n      return currentConversation;\n    }\n  )\n\n  @getter\n  messageText = createSelector(\n    () => this.state.messageTexts,\n    () => this.currentConversationId,\n    (messageTexts, conversationId) => {\n      const res = messageTexts.find(\n        msg => typeof msg === 'object' && msg.conversationId === conversationId,\n      );\n      return res ? res.text : '';\n    },\n  );\n\n  get status() {\n    return this.state.status;\n  }\n\n  get searchInput() {\n    return this.state.searchInput;\n  }\n\n  get typeFilter() {\n    return this.state.typeFilter;\n  }\n\n  get currentPage() {\n    return this.state.currentPage;\n  }\n\n  get oldConversations() {\n    return this.state.oldConversations;\n  }\n\n  get fetchConversationsStatus() {\n    return this.state.fetchConversationsStatus;\n  }\n\n  get currentConversationId() {\n    return this.state.currentConversationId;\n  }\n\n  get fetchMessagesStatus() {\n    return this.state.fetchMessagesStatus;\n  }\n\n  get oldMessages() {\n    return this.state.oldMessages;\n  }\n\n  get loadingOldConversations() {\n    return this.fetchConversationsStatus === status.fetching;\n  }\n\n  get loadingOldMessages() {\n    return this.fetchMessagesStatus === status.fetching;\n  }\n\n  get pushing() {\n    return this.state.conversationStatus === status.pushing;\n  }\n\n  get _hasPermission() {\n    return this._rolesAndPermissions.hasReadMessagesPermission;\n  }\n  get correspondentMatch() {\n    return this.state.correspondentMatch;\n  }\n  addEntitys(entitys) {\n    this.store.dispatch({\n      type: this.actionTypes.addEntity,\n      entitys,\n    });\n  }\n  removeEntity(entity) {\n    this.store.dispatch({\n      type: this.actionTypes.removeEntity,\n      entity\n    });\n  }\n  relateCorrespondentEntity(responses) {\n    if (!this._contactMatcher ||\n      !this._conversationLogger ||\n      !this.correspondentMatch.length) {\n      return;\n    }\n    responses.forEach((response) => {\n      const {\n        conversation: {\n          id\n        }\n      } = response;\n      const correspondentMatch = this.correspondentMatch;\n      const number = response.direction === messageDirection.inbound ? response.from : response.to;\n      if (number.length !== 1) {\n        return;\n      }\n      const phoneNumber = number[0].phoneNumber || number[0].extensionNumber;\n      const correspondentMatches = this._contactMatcher.dataMapping[phoneNumber];\n      if (!correspondentMatches) {\n        return;\n      }\n      const correspondentEntity = correspondentMatches.filter(match =>\n        (correspondentMatch.some(innerMatch => match.id === innerMatch.rawId)));\n      let entity = null;\n      if (correspondentEntity.length === 1) {\n        [entity] = correspondentEntity;\n        this.removeEntity(entity);\n      }\n      if (entity) {\n        this._conversationLogger.logConversation({\n          correspondentEntity: entity,\n          conversationId: id\n        });\n      }\n    });\n  }\n}\n"]}