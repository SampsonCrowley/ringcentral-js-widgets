{"version":3,"sources":["modules/GlipGroups/index.js"],"names":["glipGroupRegExp","subscriptionFilter","DEFAULT_PER_PAGE","DEFAULT_TTL","DEFAULT_RETRY","DEFAULT_RECORD_COUNT_PER_REQ","DEFAULT_PRELOAD_POSTS_DELAY_TTL","formatGroup","group","personsMap","postsMap","ownerId","id","detailMembers","members","forEach","memberId","push","isMe","newGroup","updatedTime","Date","lastModifiedTime","getTime","latestPost","creator","creatorId","postCreationTime","creationTime","getUniqueMemberIds","groups","memberIds","memberIdsMap","GlipGroups","deps","dep","optional","auth","subscription","client","tabManager","glipPersons","glipPosts","storage","rolesAndPermissions","connectivityMonitor","timeToRetry","ttl","polling","disableCache","perPage","recordCountPerReq","preloadPosts","preloadPostsDelayTtl","options","actionTypes","_auth","ensureExist","_client","_subscription","_rolesAndPermissions","_connectivityMonitor","_glipPersons","_glipPosts","_tabManager","_ttl","_timeToRetry","_polling","_perPage","_recordCountPerReq","_preloadPosts","_preloadedPosts","_preloadPostsDelayTtl","_promise","_lastMessage","_subscriptionFilters","_storage","_dataStorageKey","_timestampStorageKey","_reducer","registerReducer","key","reducer","timestamp","data","addNewPostListener","onNewPost","post","store","subscribe","_onStateChange","_shouldInit","dispatch","type","init","_init","_isDataReady","initSuccess","_onDataReady","_shouldReset","_clearTimeout","resetSuccess","_shouldSubscribe","_processSubscription","ready","_connectivity","connectivity","fetchData","_preloadGroupPosts","loggedIn","_readyCheckFn","pending","message","loadPersons","groupMemberIds","test","event","body","eventType","removeGroup","updateGroup","loadPosts","active","status","moduleStatuses","initializing","_hasPermission","_shouldFetch","console","error","_retry","_startPolling","_subscriptionHandleFn","force","slice","fetchPosts","readTimeMap","updateReadTime","now","searchFilter","pageNumber","updateFilter","length","groupId","lastGroupId","currentGroupId","lastGroupPosts","currentGroupPosts","updateCurrentGroupId","currentGroup","glip","list","recordCount","result","fetch","_fetchFunction","fetchSuccess","fetchError","_fetchData","personId","name","isPublic","description","state","getItem","hasGlipPermission","Pollable","proxify","getter","map","allGroups","filterString","toLowerCase","filter","indexOf","groupUsernames","m","firstName","lastName","join","filteredGroups","sortedGroups","sort","a","b","noTeamGroups","g","find","undefined","posts","reversePosts","reverse","sentByMe","readTime","unread"],"mappings":"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","file":"index.js","sourcesContent":["import { createSelector } from 'reselect';\n\nimport { Module } from '../../lib/di';\nimport Pollable from '../../lib/Pollable';\nimport isBlank from '../../lib/isBlank';\nimport sleep from '../../lib/sleep';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport ensureExist from '../../lib/ensureExist';\nimport getter from '../../lib/getter';\nimport proxify from '../../lib/proxy/proxify';\n\nimport getReducer, {\n  getDataReducer,\n  getTimestampReducer,\n} from './getReducer';\nimport actionTypes from './actionTypes';\n\nconst glipGroupRegExp = /glip\\/groups$/;\nconst subscriptionFilter = '/glip/groups';\n\nconst DEFAULT_PER_PAGE = 20;\nconst DEFAULT_TTL = 30 * 60 * 1000;\nconst DEFAULT_RETRY = 62 * 1000;\nconst DEFAULT_RECORD_COUNT_PER_REQ = 250;\nconst DEFAULT_PRELOAD_POSTS_DELAY_TTL = 800;\n\nfunction formatGroup(group, personsMap, postsMap = {}, ownerId) {\n  if (!group || !group.id) {\n    return {};\n  }\n  const detailMembers = [];\n  if (group.members) {\n    group.members.forEach((memberId) => {\n      if (personsMap[memberId]) {\n        detailMembers.push({\n          ...personsMap[memberId],\n          isMe: ownerId === memberId,\n        });\n      }\n    });\n  }\n  const newGroup = {\n    ...group,\n    detailMembers,\n    updatedTime: (new Date(group.lastModifiedTime)).getTime(),\n  };\n  const latestPost =\n    postsMap[group.id] && postsMap[group.id][0];\n  if (latestPost) {\n    newGroup.latestPost = {\n      ...latestPost,\n      creator: personsMap[latestPost.creatorId],\n    };\n    const postCreationTime = (new Date(latestPost.creationTime)).getTime();\n    if (postCreationTime > newGroup.updatedTime) {\n      newGroup.updatedTime = postCreationTime;\n    }\n  }\n  return newGroup;\n}\n\nfunction getUniqueMemberIds(groups) {\n  const memberIds = [];\n  const memberIdsMap = {};\n  groups.forEach((group) => {\n    group.members.forEach((memberId) => {\n      if (memberIdsMap[memberId]) {\n        return;\n      }\n      memberIdsMap[memberId] = true;\n      memberIds.push(memberId);\n    });\n  });\n  return memberIds;\n}\n\n/**\n * @class\n * @description Accound info managing module.\n */\n@Module({\n  deps: [\n    'Auth',\n    'Client',\n    'Subscription',\n    'RolesAndPermissions',\n    { dep: 'ConnectivityMonitor', optional: true },\n    { dep: 'Storage', optional: true },\n    { dep: 'TabManager', optional: true },\n    { dep: 'GlipPersons', optional: true },\n    { dep: 'GlipPosts', optional: true },\n    { dep: 'GLipGroupsOptions', optional: true }\n  ]\n})\nexport default class GlipGroups extends Pollable {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Client} params.client - client module instance\n   * @param {Auth} params.auth - auth module instance\n   * @param {RolesAndPermissions} params.rolesAndPermissions - rolesAndPermission module instance\n   * @param {Subscription} params.subscription - subscription module instance\n   * @param {TabManager} params.tabManager - tabManager module instance\n   * @param {GlipPersons} params.glipPersons - glipPersons module instance\n   * @param {GlipPosts} params.glipPosts - glipPosts module instance\n   * @param {Storage} params.storage - storage module instance\n   */\n  constructor({\n    auth,\n    subscription,\n    client,\n    tabManager,\n    glipPersons,\n    glipPosts,\n    storage,\n    rolesAndPermissions,\n    connectivityMonitor,\n    timeToRetry = DEFAULT_RETRY,\n    ttl = DEFAULT_TTL,\n    polling = false,\n    disableCache = false,\n    perPage = DEFAULT_PER_PAGE,\n    recordCountPerReq = DEFAULT_RECORD_COUNT_PER_REQ,\n    preloadPosts = true,\n    preloadPostsDelayTtl = DEFAULT_PRELOAD_POSTS_DELAY_TTL,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = this::ensureExist(auth, 'auth');\n    this._client = this::ensureExist(client, 'client');\n    this._subscription = this::ensureExist(subscription, 'subscription');\n    this._rolesAndPermissions = this::ensureExist(rolesAndPermissions, 'rolesAndPermissions');\n    this._connectivityMonitor = connectivityMonitor;\n    this._glipPersons = glipPersons;\n    this._glipPosts = glipPosts;\n    this._tabManager = tabManager;\n\n    this._ttl = ttl;\n    this._timeToRetry = timeToRetry;\n    this._polling = polling;\n    this._perPage = perPage;\n    this._recordCountPerReq = recordCountPerReq;\n    this._preloadPosts = preloadPosts;\n    this._preloadedPosts = {};\n    this._preloadPostsDelayTtl = preloadPostsDelayTtl;\n\n    this._promise = null;\n    this._lastMessage = null;\n\n    this._subscriptionFilters = [subscriptionFilter];\n    if (!disableCache) {\n      this._storage = storage;\n    }\n\n    this._dataStorageKey = 'glipGroupsData';\n    this._timestampStorageKey = 'glipGroupsTimestamp';\n\n    if (this._storage) {\n      this._reducer = getReducer(this.actionTypes);\n\n      this._storage.registerReducer({\n        key: this._dataStorageKey,\n        reducer: getDataReducer(this.actionTypes),\n      });\n      this._storage.registerReducer({\n        key: this._timestampStorageKey,\n        reducer: getTimestampReducer(this.actionTypes),\n      });\n    } else {\n      this._reducer = getReducer(this.actionTypes, {\n        timestamp: getTimestampReducer(this.actionTypes),\n        data: getDataReducer(this.actionTypes),\n      });\n    }\n\n    if (this._glipPosts) {\n      this._glipPosts.addNewPostListener(post => this.onNewPost(post));\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  async _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      await this._init();\n    } else if (this._isDataReady()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n      this._onDataReady();\n    } else if (this._shouldReset()) {\n      this._clearTimeout();\n      this._promise = null;\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    } else if (this._shouldSubscribe()) {\n      this._processSubscription();\n    } else if (\n      this.ready &&\n      this._connectivityMonitor &&\n      this._connectivityMonitor.ready &&\n      this._connectivity !== this._connectivityMonitor.connectivity\n    ) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n      if (!this._connectivity) {\n        return;\n      }\n      await this.fetchData();\n      if (this._preloadPosts) {\n        this._preloadedPosts = {};\n        this._preloadGroupPosts(true);\n      }\n    }\n  }\n\n  _shouldInit() {\n    return !!(\n      this._auth.loggedIn &&\n      this._rolesAndPermissions.ready &&\n      (!this._connectivityMonitor || this._connectivityMonitor.ready) &&\n      (!this._storage || this._storage.ready) &&\n      (!this._readyCheckFn || this._readyCheckFn()) &&\n      (!this._subscription || this._subscription.ready) &&\n      (!this._glipPosts || this._glipPosts.ready) &&\n      (!this._glipPersons || this._glipPersons.ready) &&\n      (!this._tabManager || this._tabManager.ready) &&\n      this.pending\n    );\n  }\n\n  _shouldReset() {\n    return !!(\n      (\n        !this._auth.loggedIn ||\n        !this._rolesAndPermissions.ready ||\n        (this._storage && !this._storage.ready) ||\n        (this._readyCheckFn && !this._readyCheckFn()) ||\n        (this._subscription && !this._subscription.ready) ||\n        (this._glipPosts && !this._glipPosts.ready) ||\n        (this._glipPersons && !this._glipPersons.ready) ||\n        (this._connectivityMonitor && !this._connectivityMonitor.ready) ||\n        (this._tabManager && !this._tabManager.ready)\n      ) &&\n      this.ready\n    );\n  }\n\n  _shouldSubscribe() {\n    return !!(\n      this.ready &&\n      this._subscription &&\n      this._subscription.ready &&\n      this._subscription.message &&\n      this._subscription.message !== this._lastMessage\n    );\n  }\n\n  _onDataReady() {\n    if (this._glipPersons) {\n      this._glipPersons.loadPersons(this.groupMemberIds);\n    }\n    if (this._preloadPosts) {\n      this._preloadedPosts = {};\n      this._preloadGroupPosts();\n    }\n  }\n\n  async _subscriptionHandleFn(message) {\n    if (\n      message &&\n      glipGroupRegExp.test(message.event) &&\n      message.body\n    ) {\n      const {\n        eventType,\n        ...group\n      } = message.body;\n      if (eventType === 'GroupLeft') {\n        this.store.dispatch({\n          type: this.actionTypes.removeGroup,\n          group,\n        });\n        return;\n      }\n      this.store.dispatch({\n        type: this.actionTypes.updateGroup,\n        group,\n      });\n      if (this._glipPersons) {\n        this._glipPersons.loadPersons(group.members);\n      }\n      this._glipPosts.loadPosts(group.id);\n    }\n  }\n\n  _shouldFetch() {\n    return (\n      !this._tabManager || this._tabManager.active\n    );\n  }\n\n  _isDataReady() {\n    return this.status === moduleStatuses.initializing &&\n      this.timestamp !== null;\n  }\n\n  async _init() {\n    if (!this._hasPermission) {\n      return;\n    }\n    if (this._shouldFetch()) {\n      try {\n        await this.fetchData();\n      } catch (e) {\n        console.error('fetchData error:', e);\n        this._retry();\n      }\n    } else if (this._polling) {\n      this._startPolling();\n    } else {\n      this._retry();\n    }\n    if (this._subscription && this._subscriptionFilters) {\n      this._subscription.subscribe(this._subscriptionFilters);\n    }\n    if (this._connectivityMonitor) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n    }\n  }\n\n  _processSubscription() {\n    this._lastMessage = this._subscription.message;\n    this._subscriptionHandleFn(this._lastMessage);\n  }\n\n  async _preloadGroupPosts(force) {\n    const groups = this.groups.slice(0, 20);\n    for (const group of groups) {\n      if (!this._glipPosts) {\n        break;\n      }\n      if (this._preloadedPosts[group.id]) {\n        continue;\n      }\n      this._preloadedPosts[group.id] = true;\n      if (!this._glipPosts.postsMap[group.id] || force) {\n        await sleep(this._preloadPostsDelayTtl);\n        if (!this._glipPosts.postsMap[group.id] || force) {\n          await this._glipPosts.fetchPosts(group.id);\n        }\n      }\n      if (!this._glipPosts.readTimeMap[group.id]) {\n        this._glipPosts.updateReadTime(group.id, (Date.now() - (1000 * 3600 * 2)));\n      }\n    }\n  }\n\n  @proxify\n  updateFilter({ searchFilter, pageNumber }) {\n    this.store.dispatch({\n      type: this.actionTypes.updateFilter,\n      searchFilter,\n      pageNumber,\n    });\n    if (this._preloadPosts && this.groups.length <= this._perPage * 2) {\n      this._preloadGroupPosts();\n    }\n  }\n\n  @proxify\n  updateCurrentGroupId(groupId) {\n    if (!groupId) {\n      return;\n    }\n    const lastGroupId = this.currentGroupId;\n    const lastGroupPosts = this.currentGroupPosts;\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentGroupId,\n      groupId,\n    });\n    if (this._glipPersons) {\n      this._glipPersons.loadPersons(\n        this.currentGroup && this.currentGroup.members\n      );\n    }\n    if (!this._glipPosts) {\n      return;\n    }\n    if (lastGroupPosts.length > 20) {\n      this._glipPosts.fetchPosts(lastGroupId);\n    }\n    this._glipPosts.loadPosts(groupId);\n    this._glipPosts.updateReadTime(groupId);\n  }\n\n  async _fetchFunction() {\n    const result = await this._client.glip().groups().list({\n      recordCount: this._recordCountPerReq,\n    });\n    return result;\n  }\n\n  async _fetchData() {\n    this.store.dispatch({\n      type: this.actionTypes.fetch,\n    });\n    const { ownerId } = this._auth;\n    try {\n      const data = await this._fetchFunction();\n      if (this._auth.ownerId === ownerId) {\n        this.store.dispatch({\n          type: this.actionTypes.fetchSuccess,\n          data,\n          timestamp: Date.now(),\n        });\n        if (this._polling) {\n          this._startPolling();\n        }\n        this._promise = null;\n      }\n    } catch (error) {\n      if (this._auth.ownerId === ownerId) {\n        this._promise = null;\n        this.store.dispatch({\n          type: this.actionTypes.fetchError,\n          error,\n        });\n        if (this._polling) {\n          this._startPolling(this.timeToRetry);\n        } else {\n          this._retry();\n        }\n        throw error;\n      }\n    }\n  }\n\n  @proxify\n  async fetchData() {\n    if (!this._promise) {\n      this._promise = this._fetchData();\n    }\n    return this._promise;\n  }\n\n  @proxify\n  async startChat(personId) {\n    try {\n      const group = await this._client.glip().groups().post({\n        type: 'PrivateChat',\n        members: [this._auth.ownerId, personId]\n      });\n      group.lastModifiedTime = Date.now();\n      this.store.dispatch({\n        type: this.actionTypes.updateGroup,\n        group,\n      });\n      this.store.dispatch({\n        type: this.actionTypes.updateCurrentGroupId,\n        groupId: group.id,\n      });\n      return group;\n    } catch (e) {\n      console.error(e);\n    }\n    return null;\n  }\n\n  onNewPost(post) {\n    if (post.groupId === this.currentGroupId && this._glipPosts) {\n      this._glipPosts.updateReadTime(post.groupId);\n    }\n  }\n\n  async createTeam(name, members, type = 'Team') {\n    const group = await this._client.glip().groups().post({\n      type,\n      name,\n      members,\n      isPublic: true,\n      description: ''\n    });\n    return group.id;\n  }\n\n  @getter\n  allGroups = createSelector(\n    () => this.data,\n    () => (this._glipPersons && this._glipPersons.personsMap) || {},\n    () => (this._glipPosts && this._glipPosts.postsMap) || {},\n    () => this._auth.ownerId,\n    (data, personsMap, postsMap, ownerId) => (data || []).map(\n      group => formatGroup(group, personsMap, postsMap, ownerId)\n    ),\n  )\n\n  @getter\n  filteredGroups = createSelector(\n    () => this.allGroups,\n    () => this.searchFilter,\n    (allGroups, searchFilter) => {\n      if (isBlank(searchFilter)) {\n        return allGroups;\n      }\n      const filterString = searchFilter.toLowerCase();\n      return allGroups.filter((group) => {\n        const name = group.name && group.name.toLowerCase();\n        if (name && name.indexOf(filterString) > -1) {\n          return true;\n        }\n        if (!name) {\n          const groupUsernames = group.detailMembers\n            .map(m => `${m.firstName} ${m.lastName}`)\n            .join(',')\n            .toLowerCase();\n          if (groupUsernames && groupUsernames.indexOf(filterString) > -1) {\n            return true;\n          }\n        }\n        return false;\n      });\n    },\n  )\n\n  @getter\n  groups = createSelector(\n    () => this.filteredGroups,\n    (filteredGroups) => {\n      const sortedGroups =\n        filteredGroups.sort((a, b) => {\n          if (a.updatedTime === b.updatedTime) return 0;\n          return a.updatedTime > b.updatedTime ?\n            -1 :\n            1;\n        });\n      return sortedGroups;\n    },\n  )\n\n  @getter\n  uniqueMemberIds = createSelector(\n    () => this.allGroups,\n    getUniqueMemberIds,\n  )\n\n  @getter\n  groupMemberIds = createSelector(\n    () => this.allGroups,\n    (groups) => {\n      const noTeamGroups = groups.filter(g => g.type !== 'Team');\n      return getUniqueMemberIds(noTeamGroups);\n    },\n  )\n\n  @getter\n  currentGroup = createSelector(\n    () => this.allGroups,\n    () => this.currentGroupId,\n    () => (this._glipPersons && this._glipPersons.personsMap) || {},\n    (allGroups, currentGroupId, personsMap) => {\n      const group = allGroups.find(g => g.id === currentGroupId) || {};\n      return formatGroup(group, personsMap, undefined, this._auth.ownerId);\n    },\n  )\n\n  @getter\n  currentGroupPosts = createSelector(\n    () => {\n      const postsMap = (this._glipPosts && this._glipPosts.postsMap) || {};\n      return postsMap[this.currentGroupId];\n    },\n    () => (this._glipPersons && this._glipPersons.personsMap) || {},\n    (posts, personsMap) => {\n      // const posts = postsMap[currentGroupId] || [];\n      const reversePosts = (posts || []).slice(0).reverse();\n      return reversePosts.map((post) => {\n        const creator = personsMap[post.creatorId];\n        return {\n          ...post,\n          sentByMe: post.creatorId === this._auth.ownerId,\n          creator,\n        };\n      });\n    },\n  )\n\n  @getter\n  groupsWithUnread = createSelector(\n    () => this.groups,\n    () => (this._glipPosts && this._glipPosts.postsMap) || {},\n    () => (this._glipPosts && this._glipPosts.readTimeMap) || {},\n    (groups, postsMap, readTimeMap) => groups.map((group) => {\n      const posts = postsMap[group.id] || [];\n      const readTime = readTimeMap[group.id] || Date.now();\n      return {\n        ...group,\n        unread:\n          posts.filter(post =>\n            (new Date(post.creationTime)).getTime() > readTime &&\n            post.creatorId !== this._auth.ownerId\n          ).length\n      };\n    })\n  )\n\n  get searchFilter() {\n    return this.state.searchFilter;\n  }\n\n  get data() {\n    return this._storage ?\n      this._storage.getItem(this._dataStorageKey) :\n      this.state.data;\n  }\n\n  get timestamp() {\n    return this._storage ?\n      this._storage.getItem(this._timestampStorageKey) :\n      this.state.timestamp;\n  }\n\n  get currentGroupId() {\n    return this.state.currentGroupId;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  get pending() {\n    return this.status === moduleStatuses.pending;\n  }\n\n  get ttl() {\n    return this._ttl;\n  }\n\n  get timeToRetry() {\n    return this._timeToRetry;\n  }\n\n  get _hasPermission() {\n    return !!this._rolesAndPermissions.hasGlipPermission;\n  }\n}\n"]}