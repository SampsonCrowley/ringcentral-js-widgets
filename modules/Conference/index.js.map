{"version":3,"sources":["modules/Conference/index.js"],"names":["DEFAULT_MASK","Conference","deps","dep","optional","alert","client","regionSettings","storage","rolesAndPermissions","availabilityMonitor","options","fetchFunction","mask","account","extension","conferencing","get","_alert","_dialInNumberStorageKey","_additionalNumbersStorageKey","_savedStorageKey","_regionSetting","_rolesAndPermissions","_availabilityMonitor","_lastCountryCode","_storage","registerReducer","key","reducer","actionTypes","updateDialInNumber","updateAdditionalNumbers","updateSaveCurrentSettings","data","ready","countryCode","matchedPhoneNumber","phoneNumbers","find","e","country","isoCode","phoneNumber","dialInNumber","allowJoinBeforeHost","_client","put","_store","dispatch","type","fetchSuccess","checkIfHAError","warning","message","callControlError","generalError","additionalNumbers","_saved","store","inviteWithText","joinAsHost","getItem","permissions","OrganizeConference","DataFetcher","proxify"],"mappings":"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","sourcesContent":["import mask from 'json-mask';\nimport { Module } from '../../lib/di';\nimport DataFetcher from '../../lib/DataFetcher';\nimport createSimpleReducer from '../../lib/createSimpleReducer';\nimport callControlError from '../ActiveCallControl/callControlError';\nimport actionTypes from './actionTypes';\nimport proxify from '../../lib/proxy/proxify';\n\nconst DEFAULT_MASK = 'phoneNumber,hostCode,participantCode,phoneNumbers(country(callingCode,id,isoCode,name),phoneNumber,location),allowJoinBeforeHost';\n\n/**\n * @class\n * @description Conference managing module\n */\n@Module({\n  deps: [\n    'Alert',\n    'Client',\n    'Storage',\n    'RegionSettings',\n    'RolesAndPermissions',\n    { dep: 'AvailabilityMonitor', optional: true },\n    { dep: 'ConferenceOptions', optional: true }\n  ]\n})\nexport default class Conference extends DataFetcher {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {RegionSettings} params.regionSettings - regionSettings module instance\n   * @param {Client} params.client - client module instance\n   */\n  constructor({\n    alert,\n    client,\n    regionSettings,\n    storage,\n    rolesAndPermissions,\n    availabilityMonitor,\n    ...options\n  }) {\n    super({\n      client,\n      fetchFunction: async () => mask(\n        await client.account().extension().conferencing().get(),\n        DEFAULT_MASK,\n      ),\n      storage,\n      ...options,\n    });\n    this._alert = alert;\n    this._dialInNumberStorageKey = 'conferenceDialInNumber';\n    this._additionalNumbersStorageKey = 'conferenceAdditionalNumbers';\n    this._savedStorageKey = 'conferenceSaveCurrentSettings';\n    this._regionSetting = regionSettings;\n    this._rolesAndPermissions = rolesAndPermissions;\n    this._availabilityMonitor = availabilityMonitor;\n    this._lastCountryCode = null;\n    this._storage.registerReducer({\n      key: this._dialInNumberStorageKey,\n      reducer: createSimpleReducer(this.actionTypes.updateDialInNumber, 'dialInNumber'),\n    });\n    this._storage.registerReducer({\n      key: this._additionalNumbersStorageKey,\n      reducer: createSimpleReducer(this.actionTypes.updateAdditionalNumbers, 'additionalNumbers'),\n    });\n    this._storage.registerReducer({\n      key: this._savedStorageKey,\n      reducer: createSimpleReducer(this.actionTypes.updateSaveCurrentSettings, '_saved'),\n    });\n  }\n\n  get _name() {\n    return 'conference';\n  }\n\n  get _actionTypes() {\n    return actionTypes;\n  }\n\n  async _onStateChange() {\n    super._onStateChange();\n    if (\n      !this.data ||\n      !this._regionSetting.ready ||\n      this._lastCountryCode === this._regionSetting.countryCode) {\n      return;\n    }\n    this._lastCountryCode = this._regionSetting.countryCode;\n    const matchedPhoneNumber = this.data.phoneNumbers.find(\n      e => e.country.isoCode === this._lastCountryCode\n    );\n    if (matchedPhoneNumber && matchedPhoneNumber.phoneNumber !== this.dialInNumber) {\n      this.updateDialInNumber(matchedPhoneNumber.phoneNumber);\n    }\n  }\n\n  _shouldInit() {\n    return super._shouldInit() &&\n      this._rolesAndPermissions.ready &&\n      this._alert.ready &&\n      (!this._availabilityMonitor || this._availabilityMonitor.ready);\n  }\n\n  @proxify\n  async updateEnableJoinBeforeHost(allowJoinBeforeHost) {\n    try {\n      const data = await this._client.account().extension().conferencing()\n        .put({ allowJoinBeforeHost });\n      this._store.dispatch({ type: this.actionTypes.fetchSuccess, data });\n      return data;\n    } catch (error) {\n      if (!this._availabilityMonitor || !this._availabilityMonitor.checkIfHAError(error)) {\n        this._alert.warning({ message: callControlError.generalError });\n      }\n\n      return null;\n    }\n  }\n\n  @proxify\n  updateDialInNumber(dialInNumber) {\n    this._store.dispatch({ type: this.actionTypes.updateDialInNumber, dialInNumber });\n  }\n\n  @proxify\n  updateAdditionalNumbers(additionalNumbers) {\n    this._store.dispatch({ type: this.actionTypes.updateAdditionalNumbers, additionalNumbers });\n  }\n\n  @proxify\n  updateSaveCurrentSettings(_saved) {\n    this._store.dispatch({ type: this.actionTypes.updateSaveCurrentSettings, _saved });\n  }\n\n  // for track invite with text\n  @proxify\n  onInviteWithText() {\n    this.store.dispatch({\n      type: this.actionTypes.inviteWithText\n    });\n  }\n\n  // for track join as host\n  @proxify\n  onJoinAsHost() {\n    this.store.dispatch({\n      type: this.actionTypes.joinAsHost\n    });\n  }\n\n  get additionalNumbers() {\n    return this._storage.getItem(this._additionalNumbersStorageKey) || [];\n  }\n\n  get _saved() {\n    return this._storage.getItem(this._savedStorageKey) || false;\n  }\n\n  get dialInNumber() {\n    return this._storage.getItem(this._dialInNumberStorageKey) ||\n      (this.data && this.data.phoneNumber);\n  }\n\n  get _hasPermission() {\n    return !!this._rolesAndPermissions.permissions.OrganizeConference;\n  }\n}\n"],"file":"index.js"}