{"version":3,"sources":["lib/Pollable.js"],"names":["Pollable","deps","dep","optional","options","_timeoutId","Error","clearTimeout","t","timestamp","ttl","Date","now","_clearTimeout","setTimeout","_tabManager","active","fetchData","_startPolling","timeToRetry","_retry","RcModule"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAKqBA,Q,WAHpB,iBAAQ;AACPC,EAAAA,IAAI,EAAE,CAAC;AAAEC,IAAAA,GAAG,EAAE,iBAAP;AAA0BC,IAAAA,QAAQ,EAAE;AAApC,GAAD;AADC,CAAR,C;;;;;AAIC,0BAEG;AAAA;;AAAA,QADEC,OACF;;AAAA;;AACD,oGACKA,OADL;AAGA,UAAKC,UAAL,GAAkB,IAAlB;AAJC;AAKF,G,CACD;;;;;AAYA;gCACY;AACV,YAAM,IAAIC,KAAJ,CAAU,8BAAV,CAAN;AACD;;;oCAEe;AACd,UAAI,KAAKD,UAAT,EAAqBE,YAAY,CAAC,KAAKF,UAAN,CAAZ;AACtB;;;oCAEgE;AAAA;;AAAA,UAAnDG,CAAmD,uEAA9C,KAAKC,SAAL,GAAiB,KAAKC,GAAtB,GAA4B,EAA7B,GAAmCC,IAAI,CAACC,GAAL,EAAY;;AAC/D,WAAKC,aAAL;;AACA,WAAKR,UAAL,GAAkBS,UAAU,CAAC,YAAM;AACjC,QAAA,MAAI,CAACT,UAAL,GAAkB,IAAlB;;AACA,YAAI,CAAC,MAAI,CAACU,WAAN,IAAqB,MAAI,CAACA,WAAL,CAAiBC,MAA1C,EAAkD;AAChD,cAAI,CAAC,MAAI,CAACP,SAAN,IAAmBE,IAAI,CAACC,GAAL,KAAa,MAAI,CAACH,SAAlB,GAA8B,MAAI,CAACC,GAA1D,EAA+D;AAC7D,YAAA,MAAI,CAACO,SAAL;AACD,WAFD,MAEO;AACL,YAAA,MAAI,CAACC,aAAL;AACD;AACF,SAND,MAMO,IAAI,MAAI,CAACT,SAAL,IAAkBE,IAAI,CAACC,GAAL,KAAa,MAAI,CAACH,SAAlB,GAA8B,MAAI,CAACC,GAAzD,EAA8D;AACnE,UAAA,MAAI,CAACQ,aAAL;AACD,SAFM,MAEA;AACL,UAAA,MAAI,CAACA,aAAL,CAAmB,MAAI,CAACC,WAAxB;AACD;AACF,OAb2B,EAazBX,CAbyB,CAA5B;AAcD;;;6BAC4B;AAAA;;AAAA,UAAtBA,CAAsB,uEAAlB,KAAKW,WAAa;;AAC3B,WAAKN,aAAL;;AACA,WAAKR,UAAL,GAAkBS,UAAU,CAAC,YAAM;AACjC,QAAA,MAAI,CAACT,UAAL,GAAkB,IAAlB;;AACA,YAAI,CAAC,MAAI,CAACI,SAAN,IAAmBE,IAAI,CAACC,GAAL,KAAa,MAAI,CAACH,SAAlB,GAA8B,MAAI,CAACC,GAA1D,EAA+D;AAC7D,cAAI,CAAC,MAAI,CAACK,WAAN,IAAqB,MAAI,CAACA,WAAL,CAAiBC,MAA1C,EAAkD;AAChD,YAAA,MAAI,CAACC,SAAL;AACD,WAFD,MAEO;AACL;AACA,YAAA,MAAI,CAACG,MAAL;AACD;AACF;AACF,OAV2B,EAUzBZ,CAVyB,CAA5B;AAWD;;;wBAlDe;AACd,YAAM,IAAIF,KAAJ,CAAU,0BAAV,CAAN;AACD,K,CACD;;;;wBACU;AACR,YAAM,IAAIA,KAAJ,CAAU,oBAAV,CAAN;AACD,K,CACD;;;;wBACkB;AAChB,YAAM,IAAIA,KAAJ,CAAU,4BAAV,CAAN;AACD;;;;EApBmCe,kB","sourcesContent":["import RcModule from './RcModule';\nimport { Library } from './di';\n\n@Library({\n  deps: [{ dep: 'PollableOptions', optional: true }]\n})\nexport default class Pollable extends RcModule {\n  constructor({\n    ...options\n  }) {\n    super({\n      ...options,\n    });\n    this._timeoutId = null;\n  }\n  // eslint-disable-next-line class-methods-use-this\n  get timestamp() {\n    throw new Error('timestamp is not defined');\n  }\n  // eslint-disable-next-line class-methods-use-this\n  get ttl() {\n    throw new Error('ttl is not defined');\n  }\n  // eslint-disable-next-line class-methods-use-this\n  get timeToRetry() {\n    throw new Error('timeToRetry is not defined');\n  }\n  // eslint-disable-next-line class-methods-use-this\n  fetchData() {\n    throw new Error('fetchData is not implemented');\n  }\n\n  _clearTimeout() {\n    if (this._timeoutId) clearTimeout(this._timeoutId);\n  }\n\n  _startPolling(t = (this.timestamp + this.ttl + 10) - Date.now()) {\n    this._clearTimeout();\n    this._timeoutId = setTimeout(() => {\n      this._timeoutId = null;\n      if (!this._tabManager || this._tabManager.active) {\n        if (!this.timestamp || Date.now() - this.timestamp > this.ttl) {\n          this.fetchData();\n        } else {\n          this._startPolling();\n        }\n      } else if (this.timestamp && Date.now() - this.timestamp < this.ttl) {\n        this._startPolling();\n      } else {\n        this._startPolling(this.timeToRetry);\n      }\n    }, t);\n  }\n  _retry(t = this.timeToRetry) {\n    this._clearTimeout();\n    this._timeoutId = setTimeout(() => {\n      this._timeoutId = null;\n      if (!this.timestamp || Date.now() - this.timestamp > this.ttl) {\n        if (!this._tabManager || this._tabManager.active) {\n          this.fetchData();\n        } else {\n          // continue retry checks in case tab becomes main tab\n          this._retry();\n        }\n      }\n    }, t);\n  }\n}\n"],"file":"Pollable.js"}