{"version":3,"sources":["lib/RcModule/index.js"],"names":["defaultReducer","defaultGetState","store","getState","defaultGetProxyState","RcModule","deps","dep","optional","required","warn","getProxyState","prefix","actionTypes","_actionTypes","Error","_getState","_getProxyState","_prefix","_prefixedActionTypes","enumMap","_reducer","_proxyReducer","_modulePath","_selectors","name","module","Object","prototype","hasOwnProperty","defineProperty","get","enumerable","modulePath","args","selector","pop","length","createSelector","_store","_setStore","_initModule","subModule","subscribe","_onStateChange","_suppressInit","_initialized","initialize","status","moduleStatuses","ready","pending","proxyStatuses","proxyStatus","Injector","bootstrap","deprecated","once"],"mappings":"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","sourcesContent":["import { createSelector } from 'reselect';\nimport { Injector, Library } from '../di';\nimport { prefixEnum } from '../Enum';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport proxyStatuses from '../../enums/proxyStatuses';\nimport once from '../once';\nimport required from '../required';\nimport deprecated from '../deprecated';\n\n/**\n * @function\n * @param {Object} state\n * @return {Object}\n * @description Default reducer if module does not has its own reducer.\n */\nfunction defaultReducer() {\n  return null;\n}\n\n/**\n * @function\n * @return any\n * @description Default getState function\n */\nfunction defaultGetState() {\n  return this.store.getState();\n}\n\nfunction defaultGetProxyState() {\n  return {};\n}\n\n/**\n * @class\n * @default\n * @description Base module class.\n */\n@Library({\n  deps: [{ dep: 'ModuleOptions', optional: true }]\n})\nexport default class RcModule {\n  /**\n   * @constructor\n   * @param {Function} options.getState\n   * @param {String} options.prefix\n   * @param {Enum} options.actionTypes,\n   */\n  constructor({\n    getState = defaultGetState,\n    getProxyState = defaultGetProxyState,\n    prefix,\n    actionTypes = this._actionTypes,\n  } = {}) {\n    if (typeof getState !== 'function') {\n      throw new Error(\n        'The `getState` options property must be of type function'\n      );\n    }\n    this._getState = getState;\n    this._getProxyState = getProxyState;\n    if (prefix && typeof prefix !== 'string') {\n      throw new Error('The `prefix` options property must be null, undefined, or a string');\n    }\n    this._prefix = prefix;\n    this._prefixedActionTypes = actionTypes && prefixEnum({ enumMap: actionTypes, prefix });\n    this._reducer = defaultReducer;\n    this._proxyReducer = defaultReducer;\n    this._modulePath = 'root';\n    this._selectors = {};\n  }\n\n  @required.warn\n  get _actionTypes() {\n    /* should be implemented by descendant */\n    return null;\n  }\n\n  /**\n   * @property\n   * @type any\n   * @description The state of the module\n   */\n  get state() {\n    return this._getState();\n  }\n\n  get proxyState() {\n    return this._getProxyState();\n  }\n\n  /**\n   * @property\n   * @type Function\n   * @description The reducer function of the module\n   */\n  get reducer() {\n    return this._reducer;\n  }\n\n  get proxyReducer() {\n    return this._proxyReducer;\n  }\n\n  /**\n   * @property\n   * @type Object\n   * @description The store object of the module\n   */\n  get store() {\n    if (!this._store) {\n      throw new Error('module has not been initialized...');\n    }\n    return this._store;\n  }\n\n  /**\n   * @property\n   * @type String\n   * @description The prefix string of this module\n   */\n  get prefix() {\n    return this._prefix;\n  }\n\n  /**\n   * @property\n   * @type Enum\n   * @description The actionTypes used by the module\n   */\n  get actionTypes() {\n    return this._prefixedActionTypes;\n  }\n\n  /**\n   * @property\n   * @type String\n   * @description The canonical path of the module from the root module\n   */\n  get modulePath() {\n    return this._modulePath;\n  }\n\n  /**\n   * @function addModule\n   * @param {String} name - Name of the module. Also used for the property name.\n   * @param {any} module - The module to be attached, can be any type.\n   * @description Add the desired module to the\n   */\n  addModule(name, module) {\n    if (this:: Object.prototype.hasOwnProperty(name)) {\n      throw new Error(`Property '${name}' already exists...`);\n    }\n    Object.defineProperty(this, name, {\n      get() {\n        return module;\n      },\n      enumerable: true,\n    });\n    // tag submodule with a modulePath for proxying function calls\n    // do nothing if module is already tagged\n    if (this[name]._modulePath === 'root') {\n      this[name]._modulePath = `${this.modulePath}.${name}`;\n    }\n  }\n\n  /**\n   * @function\n   * @param {String} name\n   * @description Add the selector to the internal selector object.\n   *  This is intended to be called with this.addSelector(name, selectorFn) or\n   *  this.addSelector(name, [...dependenciesFns], selectorFn);\n   */\n  @deprecated\n  addSelector(name, ...args) {\n    if (this._selectors:: Object.prototype.hasOwnProperty(name)) {\n      throw new Error(`Selector '${name}' already exists...`);\n    }\n    const selector = args.pop();\n    if (args.length > 0) {\n      this._selectors[name] = createSelector(...args, selector);\n    } else {\n      this._selectors[name] = selector;\n    }\n  }\n\n  /**\n   * @function\n   * @param {String} name\n   * @return {Function}\n   * @description Returns the named selector function\n   */\n  @deprecated\n  getSelector(name) {\n    return this._selectors[name];\n  }\n\n  /**\n   * @function\n   * @param {Object} store\n   * @description Set the store to the modules and initialize the modules.\n   *   This should only be called once.\n   */\n  setStore(store) {\n    if (this._modulePath !== 'root') {\n      throw new Error('setStore should only be called on root module');\n    }\n    if (!store) {\n      throw new Error('setStore must accept a store object');\n    }\n    if (this._store) {\n      throw new Error('setStore should only be called once');\n    }\n    this._setStore(store);\n    this._initModule();\n  }\n\n  _setStore(store) {\n    this._store = store;\n    for (const subModule in this) {\n      if (\n        this:: Object.prototype.hasOwnProperty(subModule) &&\n          this[subModule] instanceof RcModule\n      ) {\n        this[subModule]._setStore(store);\n      }\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  @once\n  @required.warn\n  _onStateChange() {}\n\n  _initModule() {\n    if (!this._suppressInit) {\n      if (\n        !this._initialized\n      ) {\n        this._initialized = true;\n        this.initialize();\n      }\n      for (const subModule in this) {\n        if (\n          this:: Object.prototype.hasOwnProperty(subModule) &&\n          this[subModule] instanceof RcModule\n        ) {\n          this[subModule]._initModule();\n        }\n      }\n    }\n  }\n\n  static create() {\n    return Injector.bootstrap(this);\n  }\n\n  /**\n   * Represents for module status, should be implemented by child class.\n   */\n  get status() {\n    throw new Error('status should be implemented.');\n  }\n\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  get pending() {\n    return this.status === moduleStatuses.pending;\n  }\n\n  get proxyStatus() {\n    return proxyStatuses.ready;\n  }\n\n  get proxyReady() {\n    return this.proxyStatus === proxyStatuses.ready;\n  }\n\n  get proxyPending() {\n    return this.proxyStatus === proxyStatuses.pending;\n  }\n}\n"],"file":"index.js"}