{"version":3,"sources":["modules/ComposeTextUI/index.js"],"names":["ComposeTextUI","name","deps","phone","brand","locale","composeText","messageSender","connectivityMonitor","rateLimiter","rolesAndPermissions","contactSearch","inputExpandable","fullName","currentLocale","sendButtonDisabled","ready","idle","messageText","length","toNumbers","typingToNumber","connectivity","throttling","senderNumbers","senderNumbersList","senderNumber","outboundSMS","permissions","OutboundSMS","searchContactList","sortedResult","showSpinner","regionSettings","routerInteraction","messageStore","conversations","formatContactPhone","phoneNumber","areaCode","countryCode","phoneTypeRenderer","phoneSourceNameRenderer","recipientsContactInfoRenderer","recipientsContactPhoneRenderer","send","timeout","setTimeout","currentPath","alertMessageSending","clearTimeout","then","responses","dismissMessageSending","pushMessages","conversationId","conversation","id","push","relateCorrespondentEntity","clean","formatPhone","searchContact","searchString","debouncedSearch","updateSenderNumber","updateTypingToNumber","cleanTypingToNumber","addToNumber","removeToNumber","updateMessageText","RcUIModule"],"mappings":"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","sourcesContent":["import Module from 'ringcentral-integration/lib/di/decorators/module';\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\n\nimport RcUIModule from '../../lib/RcUIModule';\n\n@Module({\n  name: 'ComposeTextUI',\n  deps: [\n    'Brand',\n    'ComposeText',\n    'ConnectivityMonitor',\n    'ContactSearch',\n    'Conversations',\n    'Locale',\n    'MessageSender',\n    'MessageStore',\n    'RateLimiter',\n    'RegionSettings',\n    'RolesAndPermissions',\n    'RouterInteraction',\n  ],\n})\nexport default class ComposeTextUI extends RcUIModule {\n  getUIProps({\n    phone: {\n      brand,\n      locale,\n      composeText,\n      messageSender,\n      connectivityMonitor,\n      rateLimiter,\n      rolesAndPermissions,\n      contactSearch,\n    },\n    inputExpandable\n  }) {\n    return {\n      brand: brand.fullName,\n      currentLocale: locale.currentLocale,\n      sendButtonDisabled: (\n        !(composeText.ready && messageSender.idle) ||\n        (composeText.messageText.length === 0) ||\n        (\n          composeText.toNumbers.length === 0 &&\n          composeText.typingToNumber.length === 0\n        ) ||\n        !connectivityMonitor.connectivity ||\n        rateLimiter.throttling\n      ),\n      senderNumbers: messageSender.senderNumbersList,\n      senderNumber: composeText.senderNumber,\n      typingToNumber: composeText.typingToNumber,\n      toNumbers: composeText.toNumbers,\n      messageText: composeText.messageText,\n      outboundSMS: rolesAndPermissions.permissions.OutboundSMS,\n      searchContactList: contactSearch.sortedResult,\n      showSpinner: !(\n        composeText.ready &&\n        locale.ready &&\n        messageSender.ready &&\n        rolesAndPermissions.ready &&\n        contactSearch.ready\n      ),\n      inputExpandable,\n    };\n  }\n\n  getUIFunctions({\n    phone: {\n      regionSettings,\n      routerInteraction,\n      composeText,\n      messageStore,\n      contactSearch,\n      conversations,\n    },\n    formatContactPhone = phoneNumber => formatNumber({\n      phoneNumber,\n      areaCode: regionSettings.areaCode,\n      countryCode: regionSettings.countryCode,\n    }),\n    phoneTypeRenderer,\n    phoneSourceNameRenderer,\n    recipientsContactInfoRenderer,\n    recipientsContactPhoneRenderer,\n  }) {\n    return {\n      send() {\n        let timeout = setTimeout(() => {\n          if (routerInteraction.currentPath === '/composeText') {\n            composeText.alertMessageSending();\n          }\n          if (timeout) {\n            clearTimeout(timeout);\n            timeout = null;\n          }\n        }, 10000);\n        composeText.send().then((responses) => {\n          if (timeout) {\n            clearTimeout(timeout);\n            timeout = null;\n          }\n          composeText.dismissMessageSending();\n          if (!responses || responses.length === 0) {\n            return null;\n          }\n          messageStore.pushMessages(responses);\n          if (responses.length === 1) {\n            const conversationId =\n              responses[0] && responses[0].conversation && responses[0].conversation.id;\n            if (!conversationId) {\n              return null;\n            }\n            routerInteraction.push(`/conversations/${conversationId}`);\n          } else {\n            routerInteraction.push('/messages');\n          }\n          conversations.relateCorrespondentEntity(responses);\n          composeText.clean();\n          return null;\n        }, () => {\n          if (timeout) {\n            clearTimeout(timeout);\n            timeout = null;\n          }\n        });\n      },\n      formatPhone: formatContactPhone,\n      formatContactPhone,\n      searchContact: searchString => (\n        contactSearch.debouncedSearch({ searchString })\n      ),\n      updateSenderNumber: ({ phoneNumber }) => composeText.updateSenderNumber(phoneNumber),\n      updateTypingToNumber: (...args) => composeText.updateTypingToNumber(...args),\n      cleanTypingToNumber: (...args) => composeText.cleanTypingToNumber(...args),\n      addToNumber: (...args) => composeText.addToNumber(...args),\n      removeToNumber: (...args) => composeText.removeToNumber(...args),\n      updateMessageText: (...args) => composeText.updateMessageText(...args),\n      phoneTypeRenderer,\n      phoneSourceNameRenderer,\n      recipientsContactInfoRenderer,\n      recipientsContactPhoneRenderer,\n    };\n  }\n}\n"],"file":"index.js"}