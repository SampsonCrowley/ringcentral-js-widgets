{"version":3,"sources":["integration-test/spec-modules/rolesAndPermissions.js"],"names":["authzProfileBody","require","auth","client","rolesAndPermissions","account","alert","describe","timeout","mock","mockClient","isLoginSuccess","clientHistoryRequest","ClientHistoryRequest","Map","afterEach","loggedIn","logout","it","restore","mockForLogin","console","error","skip","retries","expect","permissions","ReadUserInfo","equal","mockAuthzProfile","authzProfile","filter","p","permission","id","ReadExtensions","undefined","mockForbidden","path","login","state","messages","permissionsMessages","insufficientPrivilege","to","not"],"mappings":"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","sourcesContent":["import { ensureLogin, containsErrorMessage } from '../utils/HelpUtil';\nimport { waitInSeconds } from '../utils/WaitUtil';\nimport ClientHistoryRequest from '../utils/ClientHistoryRequest';\nimport * as mock from '../mock';\n\nimport permissionsMessages from '../../modules/RolesAndPermissions/permissionsMessages';\n\nconst authzProfileBody = require('../mock/data/authzProfile');\n\nexport default (auth, client, rolesAndPermissions, account, alert) => {\n  describe('RolesAndPermissions:', function () {\n    this.timeout(20000);\n    mock.mockClient(client);\n\n    let isLoginSuccess;\n    const clientHistoryRequest = new ClientHistoryRequest(new Map(), client);\n\n    afterEach(async function () {\n      if (auth.loggedIn) {\n        await auth.logout();\n      }\n      await waitInSeconds(1);\n    });\n\n    it('Should load permissions successfully', async () => {\n      mock.restore();\n      mock.mockForLogin();\n      isLoginSuccess = await ensureLogin(auth, account);\n      if (!isLoginSuccess) {\n        console.error('Skip test case as failed to login with credential ', account);\n        this.skip();\n      }\n      this.retries(2);\n      await waitInSeconds(1);\n      expect(rolesAndPermissions.permissions.ReadUserInfo).equal(true);\n    });\n\n    it('Should not include ReadExtensions permission', async () => {\n      mock.restore();\n      mock.mockForLogin({ mockAuthzProfile: false });\n      mock.authzProfile({\n        permissions: authzProfileBody.permissions.filter(p => p.permission.id !== 'ReadExtensions')\n      });\n      isLoginSuccess = await ensureLogin(auth, account);\n      if (!isLoginSuccess) {\n        console.error('Skip test case as failed to login with credential ', account);\n        this.skip();\n      }\n      this.retries(2);\n      await waitInSeconds(1);\n      expect(rolesAndPermissions.permissions.ReadExtensions).equal(undefined);\n    });\n\n    it('Should show insufficientPrivilege when get 403', async () => {\n      mock.restore();\n      mock.mockForLogin({ mockAuthzProfile: false });\n      mock.mockForbidden({ path: '/restapi/v1.0/account/~/extension/~/authz-profile' });\n      await auth.login({\n        ...account,\n      });\n      await waitInSeconds(3);\n      expect(auth.loggedIn).equal(false);\n      expect(containsErrorMessage(\n        alert.state.messages, permissionsMessages.insufficientPrivilege\n      )).to.not.equal(undefined);\n    });\n  });\n};\n"],"file":"rolesAndPermissions.js"}