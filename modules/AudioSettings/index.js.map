{"version":3,"sources":["modules/AudioSettings/index.js"],"names":["polyfillGetUserMedia","navigator","mediaDevices","undefined","getUserMedia","webkitGetUserMedia","mozGetUserMedia","constraints","Promise","resolve","reject","call","AudioSettings","deps","auth","alert","storage","rolesAndPermissions","options","actionTypes","_storage","ensureExist","_auth","_alert","_rolesAndPermissions","_storageKey","registerReducer","key","reducer","_reducer","addSelector","state","availableDevices","devices","device","kind","supportDevices","_checkDevices","store","subscribe","ready","loggedIn","webphoneEnabled","userMedia","hasAutoPrompted","markAutoPrompted","dispatch","type","autoPrompted","_onStateChange","addEventListener","pending","_shouldInit","init","initSuccess","_shouldReset","reset","resetSuccess","enumerateDevices","setAvailableDevices","map","d","JSON","parse","stringify","_getUserMediaPromise","audio","stream","_onGetUserMediaSuccess","getTracks","forEach","track","stop","onGetUserMediaError","userMediaAlert","item","message","audioSettingsErrors","userMediaPermission","messages","dismiss","id","getUserMediaSuccess","error","getUserMediaError","danger","allowDuplicates","ttl","dialButtonVolume","dialButtonMuted","ringtoneVolume","ringtoneMuted","callVolume","outputDeviceId","inputDeviceId","setData","getItem","deviceId","_selectors","availableOutputDevices","availableInputDevices","cacheData","isFirefox","userAgent","indexOf","length","label","status","RcModule","proxify"],"mappings":"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","sourcesContent":["import { find, filter } from 'ramda';\nimport RcModule from '../../lib/RcModule';\nimport proxify from '../../lib/proxy/proxify';\nimport { Module } from '../../lib/di';\nimport ensureExist from '../../lib/ensureExist';\nimport actionTypes from './actionTypes';\nimport getAudioSettingsReducer from './getAudioSettingsReducer';\nimport getStorageReducer from './getStorageReducer';\nimport audioSettingsErrors from './audioSettingsErrors';\n\nfunction polyfillGetUserMedia() {\n  if (navigator.mediaDevices === undefined) {\n    navigator.mediaDevices = {};\n  }\n  navigator.getUserMedia =\n    navigator.getUserMedia ||\n    navigator.webkitGetUserMedia ||\n    navigator.mozGetUserMedia;\n  if (navigator.mediaDevices.getUserMedia === undefined && navigator.getUserMedia) {\n    navigator.mediaDevices.getUserMedia = constraints => (\n      new Promise((resolve, reject) => {\n        navigator.getUserMedia.call(navigator, constraints, resolve, reject);\n      })\n    );\n  }\n}\npolyfillGetUserMedia();\n\n/**\n * @class\n * @description AudioSettings module.\n */\n@Module({\n  deps: [\n    'Auth',\n    'Alert',\n    'Storage',\n    'RolesAndPermissions',\n  ],\n})\nexport default class AudioSettings extends RcModule {\n  constructor({\n    auth,\n    alert,\n    storage,\n    rolesAndPermissions,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._storage = this:: ensureExist(storage, 'storage');\n    this._auth = this:: ensureExist(auth, 'auth');\n    this._alert = this:: ensureExist(alert, 'alert');\n    this._rolesAndPermissions = this:: ensureExist(rolesAndPermissions, 'rolesAndPermissions');\n    this._storageKey = 'audioSettings';\n    this._storage.registerReducer({\n      key: this._storageKey,\n      reducer: getStorageReducer(this.actionTypes),\n    });\n    this._reducer = getAudioSettingsReducer(this.actionTypes);\n\n    this.addSelector('availableOutputDevices',\n      () => this.state.availableDevices,\n      devices => filter(device => device.kind === 'audiooutput', devices),\n    );\n    this.addSelector('availableInputDevices',\n      () => this.state.availableDevices,\n      devices => filter(device => device.kind === 'audioinput', devices),\n    );\n  }\n\n  initializeProxy() {\n    // Check audio permissions everytime app client starts\n    if (this.supportDevices) {\n      this._checkDevices();\n    }\n    this.store.subscribe(() => {\n      if (\n        this.ready &&\n        this._auth.loggedIn &&\n        this._rolesAndPermissions.webphoneEnabled &&\n        !this.userMedia\n      ) {\n        // Make sure it only prompts once\n        if (this.hasAutoPrompted) return;\n        this.markAutoPrompted();\n        this.getUserMedia();\n      }\n    });\n  }\n\n  @proxify\n  async markAutoPrompted() {\n    this.store.dispatch({\n      type: this.actionTypes.autoPrompted\n    });\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n    if (\n      navigator &&\n      navigator.mediaDevices &&\n      navigator.mediaDevices.addEventListener\n    ) {\n      navigator.mediaDevices.addEventListener('devicechange', () => {\n        this._checkDevices();\n      });\n    }\n  }\n\n  _shouldInit() {\n    return !!(\n      this.pending &&\n      this._storage.ready &&\n      this._auth.ready &&\n      this._rolesAndPermissions.ready\n    );\n  }\n\n  _shouldReset() {\n    return !!(\n      this.ready &&\n      (\n        !this._auth.ready ||\n        !this._storage.ready ||\n        !this._rolesAndPermissions.ready\n      )\n    );\n  }\n\n  async _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      if (this.supportDevices) {\n        await this._checkDevices();\n      }\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (this._shouldReset()) {\n      this.store.dispatch({\n        type: this.actionTypes.reset,\n      });\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    }\n  }\n\n  @proxify\n  async _checkDevices() {\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    this.store.dispatch({\n      type: this.actionTypes.setAvailableDevices,\n      // TODO formatting for devices info instances and replace JSON APIs.\n      devices: devices.map(d => JSON.parse(JSON.stringify(d))),\n    });\n  }\n\n  async getUserMedia() {\n    if (!navigator.mediaDevices.getUserMedia) {\n      return;\n    }\n    try {\n      if (!this._getUserMediaPromise) {\n        this._getUserMediaPromise = navigator.mediaDevices.getUserMedia({ audio: true });\n      }\n      const stream = await this._getUserMediaPromise;\n      this._getUserMediaPromise = null;\n      await this._onGetUserMediaSuccess();\n      if (typeof stream.getTracks === 'function') {\n        stream.getTracks().forEach((track) => {\n          track.stop();\n        });\n      } else if (typeof stream.stop === 'function') {\n        stream.stop();\n      }\n    } catch (error) {\n      this._getUserMediaPromise = null;\n      this.onGetUserMediaError(error);\n    }\n  }\n\n  @proxify\n  async _onGetUserMediaSuccess() {\n    const userMediaAlert = find(\n      item => item.message === audioSettingsErrors.userMediaPermission,\n      this._alert.messages,\n    );\n    if (userMediaAlert) {\n      this._alert.dismiss(userMediaAlert.id);\n    }\n    this.store.dispatch({\n      type: this.actionTypes.getUserMediaSuccess,\n    });\n    await this._checkDevices();\n  }\n\n  @proxify\n  async onGetUserMediaError(error) {\n    this.store.dispatch({\n      type: this.actionTypes.getUserMediaError,\n      error,\n    });\n    this._alert.danger({\n      message: audioSettingsErrors.userMediaPermission,\n      allowDuplicates: false,\n    });\n  }\n\n  @proxify\n  async showAlert() {\n    if (!this.userMedia) {\n      this._alert.danger({\n        message: audioSettingsErrors.userMediaPermission,\n        allowDuplicates: false,\n        ttl: 30 * 1000,\n      });\n    }\n  }\n\n  @proxify\n  async setData({\n    dialButtonVolume = this.dialButtonVolume,\n    dialButtonMuted = this.dialButtonMuted,\n    ringtoneVolume = this.ringtoneVolume,\n    ringtoneMuted = this.ringtoneMuted,\n    callVolume = this.callVolume,\n    outputDeviceId = this.outputDeviceId,\n    inputDeviceId = this.inputDeviceId,\n  }) {\n    this.store.dispatch({\n      type: this.actionTypes.setData,\n      dialButtonVolume,\n      dialButtonMuted,\n      ringtoneVolume,\n      ringtoneMuted,\n      callVolume,\n      outputDeviceId,\n      inputDeviceId,\n    });\n  }\n\n  get outputDeviceId() {\n    return this._storage.getItem(this._storageKey).outputDeviceId;\n  }\n\n  get outputDevice() {\n    return find(device => (\n      device.kind === 'audiooutput' &&\n      device.deviceId === this.outputDeviceId\n    ), this.availableDevices);\n  }\n\n  get inputDeviceId() {\n    return this._storage.getItem(this._storageKey).inputDeviceId;\n  }\n\n  get inputDevice() {\n    return find(device => (\n      device.kind === 'audioinput' &&\n      device.deviceId === this.inputDeviceId\n    ), this.availableDevices);\n  }\n\n  get supportDevices() {\n    return !!(\n      navigator.mediaDevices &&\n      navigator.mediaDevices.enumerateDevices\n    );\n  }\n\n  get availableDevices() {\n    return this.state.availableDevices;\n  }\n\n  get availableOutputDevices() {\n    return this._selectors.availableOutputDevices();\n  }\n\n  get availableInputDevices() {\n    return this._selectors.availableInputDevices();\n  }\n\n  get cacheData() {\n    return this._storage.getItem(this._storageKey) || {};\n  }\n\n  get dialButtonVolume() {\n    return this.cacheData.dialButtonVolume;\n  }\n\n  get dialButtonMuted() {\n    return this.cacheData.dialButtonMuted;\n  }\n\n  get ringtoneVolume() {\n    return this.cacheData.ringtoneVolume;\n  }\n\n  get ringtoneMuted() {\n    return this.cacheData.ringtoneMuted;\n  }\n\n  get callVolume() {\n    return this.cacheData.callVolume;\n  }\n\n  get userMedia() {\n    const isFirefox = navigator.userAgent.indexOf('Firefox') > -1;\n    if (isFirefox) {\n      return true;\n    }\n    // this detection method may not work in the future\n    // currently there is no good way to detect this\n    return !!(\n      this.availableDevices.length &&\n      this.availableDevices[0].label !== ''\n    );\n  }\n\n  get hasAutoPrompted() {\n    return this.cacheData.hasAutoPrompted;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n}\n"],"file":"index.js"}