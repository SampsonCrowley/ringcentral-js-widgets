{"version":3,"sources":["containers/SimpleActiveCallCtrlPage/index.js"],"names":["mapToProps","_","phone","activeCallControl","regionSettings","callMonitor","locale","brand","renderContactName","activeSession","sessionId","activeSessionId","activeCall","String","otherDeviceCalls","nameMatches","direction","callDirections","outbound","toMatches","fromMatches","phoneNumber","to","from","fallBackName","i18n","getString","currentLocale","fallBackNameFromThirdParty","fallBackNumber","session","areaCode","countryCode","fullName","mapToFunctions","routerInteraction","onBackButtonClick","goBack","ActiveCallControl","props","state","selectedMatcherIndex","onMute","mute","onUnmute","unmute","onHold","hold","onUnhold","unHold","onHangup","hangUp","onTransfer","number","transfer","formatPhone","onSelectMatcherName","option","findIndex","match","id","setState","nextProps","muteCtrl","ACTIONS_CTRL_MAP","transferCtrl","holdCtrl","callCtrlLayouts","normalCtrl","startTime","isOnMute","isOnHold","showContactDisplayPlaceholder","Component","propTypes","PropTypes","string","isRequired","object","func","array","bool","defaultProps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AAEA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AAEA,SAASA,UAAT,CAAoBC,CAApB,QASG;AAAA,wBARDC,KAQC;AAAA,MAPCC,iBAOD,cAPCA,iBAOD;AAAA,MANCC,cAMD,cANCA,cAMD;AAAA,MALCC,WAKD,cALCA,WAKD;AAAA,MAJCC,MAID,cAJCA,MAID;AAAA,MAHCC,KAGD,cAHCA,KAGD;AAAA,MADDC,iBACC,QADDA,iBACC;AAAA,MACOC,aADP,GACqDN,iBADrD,CACOM,aADP;AAAA,MACuCC,SADvC,GACqDP,iBADrD,CACsBQ,eADtB;;AAED,MAAMC,aAAa,2BACjB,EAAEF,WAAWG,OAAOH,SAAP,CAAb,EADiB,EAEjBL,YAAYS,gBAFK,EAGjB,CAHiB,CAAnB;AAIA,MAAIC,cAAc,EAAlB;AACA,MAAIH,cAAc,CAACJ,iBAAnB,EAAsC;AACpCO,kBACEN,cAAcO,SAAd,KAA4BC,yBAAeC,QAA3C,GACEN,WAAWO,SADb,GACyBP,WAAWQ,WAFtC;AAGD;AACD,MAAIC,oBAAJ;AACA,MAAIZ,aAAJ,EAAmB;AACjBY,kBAAcZ,cAAcO,SAAd,KAA4BC,yBAAeC,QAA3C,GACZT,cAAca,EADF,GACOb,cAAcc,IADnC;AAED;AACD,MAAIC,eAAeC,eAAKC,SAAL,CAAe,SAAf,EAA0BpB,OAAOqB,aAAjC,CAAnB;AACA,MAAInB,iBAAJ,EAAuB;AAAA,4BACgD,6BACnEI,UADmE,EAEnEJ,kBAAkBE,SAAlB,CAFmE,EAGnEJ,OAAOqB,aAH4D,CADhD;AAAA,QACCC,0BADD,qBACbJ,YADa;AAAA,QAC6BK,cAD7B,qBAC6BA,cAD7B;;AAMrBR,kBAAcQ,cAAd;AACAL,mBAAeI,0BAAf;AACD;AACD,SAAO;AACLD,mBAAerB,OAAOqB,aADjB;AAELG,aAASrB,aAFJ;AAGLG,0BAHK;AAILF,eAAWP,kBAAkBQ,eAJxB;AAKLoB,cAAU3B,eAAe2B,QALpB;AAMLC,iBAAa5B,eAAe4B,WANvB;AAOLlB,sBAAkBT,YAAYS,gBAPzB;AAQLC,4BARK;AASLM,4BATK;AAULG,8BAVK;AAWLjB,WAAOA,MAAM0B,QAXR;AAYL9B;AAZK,GAAP;AAcD,C,CArED;;;;;AAuEA,SAAS+B,cAAT,CAAwBjC,CAAxB,SAIG;AAAA,MAFCkC,iBAED,SAHDjC,KAGC,CAFCiC,iBAED;;AACD,SAAO;AACLC,uBAAmB;AAAA,aAAMD,kBAAkBE,MAAlB,EAAN;AAAA;AADd,GAAP;AAGD;;IAEKC,iB;;;AACJ,6BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AAAA,4JACXA,KADW;;AAGjB,UAAKC,KAAL,GAAa;AACXC,4BAAsB;AADX,KAAb;;AAIA,UAAKC,MAAL,GAAc;AAAA,aAAM,MAAKH,KAAL,CAAWpC,iBAAX,CAA6BwC,IAA7B,CAAkC,MAAKJ,KAAL,CAAW7B,SAA7C,CAAN;AAAA,KAAd;AACA,UAAKkC,QAAL,GAAgB;AAAA,aAAM,MAAKL,KAAL,CAAWpC,iBAAX,CAA6B0C,MAA7B,CAAoC,MAAKN,KAAL,CAAW7B,SAA/C,CAAN;AAAA,KAAhB;AACA,UAAKoC,MAAL,GAAc;AAAA,aAAM,MAAKP,KAAL,CAAWpC,iBAAX,CAA6B4C,IAA7B,CAAkC,MAAKR,KAAL,CAAW7B,SAA7C,CAAN;AAAA,KAAd;AACA,UAAKsC,QAAL,GAAgB;AAAA,aAAM,MAAKT,KAAL,CAAWpC,iBAAX,CAA6B8C,MAA7B,CAAoC,MAAKV,KAAL,CAAW7B,SAA/C,CAAN;AAAA,KAAhB;AACA,UAAKwC,QAAL,GAAgB;AAAA,aAAM,MAAKX,KAAL,CAAWpC,iBAAX,CAA6BgD,MAA7B,CAAoC,MAAKZ,KAAL,CAAW7B,SAA/C,CAAN;AAAA,KAAhB;AACA,UAAK0C,UAAL;AAAA,2FAAkB,iBAAMC,MAAN;AAAA;AAAA;AAAA;AAAA;AAAA,iDAChB,MAAKd,KAAL,CAAWpC,iBAAX,CAA6BmD,QAA7B,CAAsCD,MAAtC,EAA8C,MAAKd,KAAL,CAAW7B,SAAzD,CADgB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAlB;;AAAA;AAAA;AAAA;AAAA;;AAGA,UAAK6C,WAAL,GAAmB;AAAA,aAAe,4BAAa;AAC7ClC,gCAD6C;AAE7CU,kBAAU,MAAKQ,KAAL,CAAWR,QAFwB;AAG7CC,qBAAa,MAAKO,KAAL,CAAWP;AAHqB,OAAb,CAAf;AAAA,KAAnB;;AAMA,UAAKwB,mBAAL,GAA2B,UAACC,MAAD,EAAY;AACrC,UAAM1C,cAAc,MAAKwB,KAAL,CAAWxB,WAAX,IAA0B,EAA9C;AACA,UAAI0B,uBAAuB1B,YAAY2C,SAAZ,CACzB;AAAA,eAASC,MAAMC,EAAN,KAAaH,OAAOG,EAA7B;AAAA,OADyB,CAA3B;AAGA,UAAInB,uBAAuB,CAA3B,EAA8B;AAC5BA,+BAAuB,CAAvB;AACD;AACD,YAAKoB,QAAL,CAAc;AACZpB;AADY,OAAd;AAGD,KAXD;AArBiB;AAiClB;;;;8CAEyBqB,S,EAAW;AACnC,UAAI,CAACA,UAAUhC,OAAf,EAAwB;AACtB,aAAKS,KAAL,CAAWH,iBAAX;AACD;AACF;;;6BAEQ;AACP,UAAI,CAAC,KAAKG,KAAL,CAAWT,OAAhB,EAAyB;AACvB,eAAO,IAAP;AACD;AAHM,UAICiC,QAJD,GAIsCC,+BAJtC,CAICD,QAJD;AAAA,UAIWE,YAJX,GAIsCD,+BAJtC,CAIWC,YAJX;AAAA,UAIyBC,QAJzB,GAIsCF,+BAJtC,CAIyBE,QAJzB;;;AAMP,aACE,8BAAC,uBAAD;AACE,uBAAe,KAAK3B,KAAL,CAAWZ,aAD5B;AAEE,sBAAc,KAAKY,KAAL,CAAWf,YAF3B;AAGE,qBAAa,KAAKe,KAAL,CAAWlB,WAH1B;AAIE,gBAAQ,KAAKqB,MAJf;AAKE,kBAAU,KAAKE,QALjB;AAME,gBAAQ,KAAKE,MANf;AAOE,kBAAU,KAAKE,QAPjB;AAQE,kBAAU,KAAKE,QARjB;AASE,oBAAY,KAAKE,UATnB;AAUE,4BAVF;AAWE,yBAAiB3B,eAAKC,SAAL,CAAe,UAAf,EAA2B,KAAKa,KAAL,CAAWZ,aAAtC,CAXnB;AAYE,2BAAmB,KAAKY,KAAL,CAAWH,iBAZhC;AAaE,qBAAa,KAAKmB,WAbpB;AAcE,kBAAU,KAAKhB,KAAL,CAAWR,QAdvB;AAeE,qBAAa,KAAKQ,KAAL,CAAWP,WAf1B;AAgBE,8BAAsB,KAAKQ,KAAL,CAAWC,oBAhBnC;AAiBE,gBAAQ0B,0BAAgBC,UAjB1B;AAkBE,mBAAW,KAAK7B,KAAL,CAAW3B,UAAX,CAAsByD,SAlBnC;AAmBE,iBAAS,CAACN,QAAD,EAAWE,YAAX,EAAyBC,QAAzB,CAnBX;AAoBE,kBAAU,KAAK3B,KAAL,CAAWT,OAAX,CAAmBwC,QApB/B;AAqBE,kBAAU,KAAK/B,KAAL,CAAWT,OAAX,CAAmByC,QArB/B;AAsBE,qBAAa,KAAKhC,KAAL,CAAWxB,WAtB1B;AAuBE,6BAAqB,KAAKyC,mBAvB5B;AAwBE,eAAO,KAAKjB,KAAL,CAAWhC,KAxBpB;AAyBE,uCAA+B,KAAKgC,KAAL,CAAWiC;AAzB5C,QADF;AA6BD;;;EA7E6BC,gB;;AAgFhCnC,kBAAkBoC,SAAlB,GAA8B;AAC5B/C,iBAAegD,oBAAUC,MADG;AAE5BlE,aAAWiE,oBAAUC,MAFO;AAG5B7C,YAAU4C,oBAAUC,MAAV,CAAiBC,UAHC;AAI5B7C,eAAa2C,oBAAUC,MAAV,CAAiBC,UAJF;AAK5B/C,WAAS6C,oBAAUG,MALS;AAM5BlE,cAAY+D,oBAAUG,MANM;AAO5B1C,qBAAmBuC,oBAAUI,IAAV,CAAeF,UAPN;AAQ5B1E,qBAAmBwE,oBAAUG,MARD;AAS5B/D,eAAa4D,oBAAUK,KATK;AAU5BxD,gBAAcmD,oBAAUC,MAVI;AAW5BvD,eAAasD,oBAAUC,MAXK;AAY5BJ,iCAA+BG,oBAAUM,IAZb;AAa5B1E,SAAOoE,oBAAUC,MAAV,CAAiBC;AAbI,CAA9B;;AAgBAvC,kBAAkB4C,YAAlB,GAAiC;AAC/BvD,iBAAe,OADgB;AAE/BxB,qBAAmB,EAFY;AAG/B2B,WAAS,IAHsB;AAI/BpB,aAAW,IAJoB;AAK/BE,cAAY,EALmB;AAM/BG,eAAa,EANkB;AAO/BS,gBAAc,EAPiB;AAQ/BH,eAAa,EARkB;AAS/BmD,iCAA+B;AATA,CAAjC;;kBAYe,yBAAU,yBAAQxE,UAAR,EAAoBkC,cAApB,EAAoCI,iBAApC,CAAV,C","file":"index.js","sourcesContent":["/**\n * @file simplify active call control page\n * detail: https://jira.ringcentral.com/browse/RCINT-8256\n */\n\nimport { connect } from 'react-redux';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\nimport callDirections from 'ringcentral-integration/enums/callDirections';\n\nimport withPhone from '../../lib/withPhone';\n\nimport CallCtrlPanel from '../../components/CallCtrlPanel';\nimport callCtrlLayouts from '../../enums/callCtrlLayouts';\nimport { ACTIONS_CTRL_MAP } from '../../components/ActiveCallPad';\nimport i18n from './i18n';\nimport { pickEleByProps, pickFallBackInfo } from './utils';\n\nfunction mapToProps(_, {\n  phone: {\n    activeCallControl,\n    regionSettings,\n    callMonitor,\n    locale,\n    brand,\n  },\n  renderContactName,\n}) {\n  const { activeSession, activeSessionId: sessionId } = activeCallControl;\n  const activeCall = pickEleByProps(\n    { sessionId: String(sessionId) },\n    callMonitor.otherDeviceCalls\n  )[0];\n  let nameMatches = [];\n  if (activeCall && !renderContactName) {\n    nameMatches =\n      activeSession.direction === callDirections.outbound ?\n        activeCall.toMatches : activeCall.fromMatches;\n  }\n  let phoneNumber;\n  if (activeSession) {\n    phoneNumber = activeSession.direction === callDirections.outbound ?\n      activeSession.to : activeSession.from;\n  }\n  let fallBackName = i18n.getString('Unknown', locale.currentLocale);\n  if (renderContactName) {\n    const { fallBackName: fallBackNameFromThirdParty, fallBackNumber } = pickFallBackInfo(\n      activeCall,\n      renderContactName(sessionId),\n      locale.currentLocale\n    );\n    phoneNumber = fallBackNumber;\n    fallBackName = fallBackNameFromThirdParty;\n  }\n  return {\n    currentLocale: locale.currentLocale,\n    session: activeSession,\n    activeCall,\n    sessionId: activeCallControl.activeSessionId,\n    areaCode: regionSettings.areaCode,\n    countryCode: regionSettings.countryCode,\n    otherDeviceCalls: callMonitor.otherDeviceCalls,\n    nameMatches,\n    phoneNumber,\n    fallBackName,\n    brand: brand.fullName,\n    activeCallControl,\n  };\n}\n\nfunction mapToFunctions(_, {\n  phone: {\n    routerInteraction,\n  },\n}) {\n  return {\n    onBackButtonClick: () => routerInteraction.goBack(),\n  };\n}\n\nclass ActiveCallControl extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      selectedMatcherIndex: 0,\n    };\n\n    this.onMute = () => this.props.activeCallControl.mute(this.props.sessionId);\n    this.onUnmute = () => this.props.activeCallControl.unmute(this.props.sessionId);\n    this.onHold = () => this.props.activeCallControl.hold(this.props.sessionId);\n    this.onUnhold = () => this.props.activeCallControl.unHold(this.props.sessionId);\n    this.onHangup = () => this.props.activeCallControl.hangUp(this.props.sessionId);\n    this.onTransfer = async number =>\n      this.props.activeCallControl.transfer(number, this.props.sessionId);\n\n    this.formatPhone = phoneNumber => formatNumber({\n      phoneNumber,\n      areaCode: this.props.areaCode,\n      countryCode: this.props.countryCode,\n    });\n\n    this.onSelectMatcherName = (option) => {\n      const nameMatches = this.props.nameMatches || [];\n      let selectedMatcherIndex = nameMatches.findIndex(\n        match => match.id === option.id\n      );\n      if (selectedMatcherIndex < 0) {\n        selectedMatcherIndex = 0;\n      }\n      this.setState({\n        selectedMatcherIndex,\n      });\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (!nextProps.session) {\n      this.props.onBackButtonClick();\n    }\n  }\n\n  render() {\n    if (!this.props.session) {\n      return null;\n    }\n    const { muteCtrl, transferCtrl, holdCtrl } = ACTIONS_CTRL_MAP;\n\n    return (\n      <CallCtrlPanel\n        currentLocale={this.props.currentLocale}\n        fallBackName={this.props.fallBackName}\n        phoneNumber={this.props.phoneNumber}\n        onMute={this.onMute}\n        onUnmute={this.onUnmute}\n        onHold={this.onHold}\n        onUnhold={this.onUnhold}\n        onHangup={this.onHangup}\n        onTransfer={this.onTransfer}\n        showBackButton\n        backButtonLabel={i18n.getString('allCalls', this.props.currentLocale)}\n        onBackButtonClick={this.props.onBackButtonClick}\n        formatPhone={this.formatPhone}\n        areaCode={this.props.areaCode}\n        countryCode={this.props.countryCode}\n        selectedMatcherIndex={this.state.selectedMatcherIndex}\n        layout={callCtrlLayouts.normalCtrl}\n        startTime={this.props.activeCall.startTime}\n        actions={[muteCtrl, transferCtrl, holdCtrl]}\n        isOnMute={this.props.session.isOnMute}\n        isOnHold={this.props.session.isOnHold}\n        nameMatches={this.props.nameMatches}\n        onSelectMatcherName={this.onSelectMatcherName}\n        brand={this.props.brand}\n        showContactDisplayPlaceholder={this.props.showContactDisplayPlaceholder}\n      />\n    );\n  }\n}\n\nActiveCallControl.propTypes = {\n  currentLocale: PropTypes.string,\n  sessionId: PropTypes.string,\n  areaCode: PropTypes.string.isRequired,\n  countryCode: PropTypes.string.isRequired,\n  session: PropTypes.object,\n  activeCall: PropTypes.object,\n  onBackButtonClick: PropTypes.func.isRequired,\n  activeCallControl: PropTypes.object,\n  nameMatches: PropTypes.array,\n  fallBackName: PropTypes.string,\n  phoneNumber: PropTypes.string,\n  showContactDisplayPlaceholder: PropTypes.bool,\n  brand: PropTypes.string.isRequired,\n};\n\nActiveCallControl.defaultProps = {\n  currentLocale: 'en-US',\n  activeCallControl: {},\n  session: null,\n  sessionId: null,\n  activeCall: {},\n  nameMatches: [],\n  fallBackName: '',\n  phoneNumber: '',\n  showContactDisplayPlaceholder: false,\n};\n\nexport default withPhone(connect(mapToProps, mapToFunctions)(ActiveCallControl));\n"]}